(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{"8GU6":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("lin5"),i=n("A6N3"),s=n("O5DG"),o=n("XKyx"),u=n("d+zW"),a=s.OPS,p=n("KfcP"),c=n("vyt/"),h=t.alloc(0);e.p2wpkh=function(e,n){if(!(e.address||e.hash||e.output||e.pubkey||e.witness))throw new TypeError("Not enough data");n=Object.assign({validate:!0},n||{}),u({address:u.maybe(u.String),hash:u.maybe(u.BufferN(20)),input:u.maybe(u.BufferN(0)),network:u.maybe(u.Object),output:u.maybe(u.BufferN(22)),pubkey:u.maybe(p.isPoint),signature:u.maybe(s.isCanonicalScriptSignature),witness:u.maybe(u.arrayOf(u.Buffer))},e);const f=o.value(()=>{const n=c.decode(e.address),r=n.words.shift(),i=c.fromWords(n.words);return{version:r,prefix:n.prefix,data:t.from(i)}}),l=e.network||i.bitcoin,d={name:"p2wpkh",network:l};if(o.prop(d,"address",()=>{if(!d.hash)return;const t=c.toWords(d.hash);return t.unshift(0),c.encode(l.bech32,t)}),o.prop(d,"hash",()=>e.output?e.output.slice(2,22):e.address?f().data:e.pubkey||d.pubkey?r.hash160(e.pubkey||d.pubkey):void 0),o.prop(d,"output",()=>{if(d.hash)return s.compile([a.OP_0,d.hash])}),o.prop(d,"pubkey",()=>e.pubkey?e.pubkey:e.witness?e.witness[1]:void 0),o.prop(d,"signature",()=>{if(e.witness)return e.witness[0]}),o.prop(d,"input",()=>{if(d.witness)return h}),o.prop(d,"witness",()=>{if(e.pubkey&&e.signature)return[e.signature,e.pubkey]}),n.validate){let n=t.from([]);if(e.address){if(l&&l.bech32!==f().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(0!==f().version)throw new TypeError("Invalid address version");if(20!==f().data.length)throw new TypeError("Invalid address data");n=f().data}if(e.hash){if(n.length>0&&!n.equals(e.hash))throw new TypeError("Hash mismatch");n=e.hash}if(e.output){if(22!==e.output.length||e.output[0]!==a.OP_0||20!==e.output[1])throw new TypeError("Output is invalid");if(n.length>0&&!n.equals(e.output.slice(2)))throw new TypeError("Hash mismatch");n=e.output.slice(2)}if(e.pubkey){const t=r.hash160(e.pubkey);if(n.length>0&&!n.equals(t))throw new TypeError("Hash mismatch");n=t}if(e.witness){if(2!==e.witness.length)throw new TypeError("Witness is invalid");if(!s.isCanonicalScriptSignature(e.witness[0]))throw new TypeError("Witness has invalid signature");if(!p.isPoint(e.witness[1]))throw new TypeError("Witness has invalid pubkey");if(e.signature&&!e.signature.equals(e.witness[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(e.witness[1]))throw new TypeError("Pubkey mismatch");const t=r.hash160(e.witness[1]);if(n.length>0&&!n.equals(t))throw new TypeError("Hash mismatch")}}return Object.assign(d,e)}}).call(this,n("HDXh").Buffer)},"9PLV":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("O5DG"),s=n("wmJG"),o=n("d+zW"),u=t.from("aa21a9ed","hex");function a(t){const e=r.compile(t);return e.length>37&&e[0]===i.OPS.OP_RETURN&&36===e[1]&&e.slice(2,6).equals(u)}e.check=a,a.toJSON=()=>"Witness commitment output",e.encode=function(e){o(s.Hash256bit,e);const n=t.allocUnsafe(36);return u.copy(n,0),e.copy(n,4),r.compile([i.OPS.OP_RETURN,n])},e.decode=function(t){return o(a,t),r.decompile(t)[1].slice(4,36)}}).call(this,n("HDXh").Buffer)},A6N3:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.bitcoin={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},e.regtest={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},e.testnet={messagePrefix:"Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239}},CB62:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("pFpI");e.input=r;const i=n("TJSY");e.output=i},E0BK:function(t){t.exports=JSON.parse('{"OP_FALSE":0,"OP_0":0,"OP_PUSHDATA1":76,"OP_PUSHDATA2":77,"OP_PUSHDATA4":78,"OP_1NEGATE":79,"OP_RESERVED":80,"OP_TRUE":81,"OP_1":81,"OP_2":82,"OP_3":83,"OP_4":84,"OP_5":85,"OP_6":86,"OP_7":87,"OP_8":88,"OP_9":89,"OP_10":90,"OP_11":91,"OP_12":92,"OP_13":93,"OP_14":94,"OP_15":95,"OP_16":96,"OP_NOP":97,"OP_VER":98,"OP_IF":99,"OP_NOTIF":100,"OP_VERIF":101,"OP_VERNOTIF":102,"OP_ELSE":103,"OP_ENDIF":104,"OP_VERIFY":105,"OP_RETURN":106,"OP_TOALTSTACK":107,"OP_FROMALTSTACK":108,"OP_2DROP":109,"OP_2DUP":110,"OP_3DUP":111,"OP_2OVER":112,"OP_2ROT":113,"OP_2SWAP":114,"OP_IFDUP":115,"OP_DEPTH":116,"OP_DROP":117,"OP_DUP":118,"OP_NIP":119,"OP_OVER":120,"OP_PICK":121,"OP_ROLL":122,"OP_ROT":123,"OP_SWAP":124,"OP_TUCK":125,"OP_CAT":126,"OP_SUBSTR":127,"OP_LEFT":128,"OP_RIGHT":129,"OP_SIZE":130,"OP_INVERT":131,"OP_AND":132,"OP_OR":133,"OP_XOR":134,"OP_EQUAL":135,"OP_EQUALVERIFY":136,"OP_RESERVED1":137,"OP_RESERVED2":138,"OP_1ADD":139,"OP_1SUB":140,"OP_2MUL":141,"OP_2DIV":142,"OP_NEGATE":143,"OP_ABS":144,"OP_NOT":145,"OP_0NOTEQUAL":146,"OP_ADD":147,"OP_SUB":148,"OP_MUL":149,"OP_DIV":150,"OP_MOD":151,"OP_LSHIFT":152,"OP_RSHIFT":153,"OP_BOOLAND":154,"OP_BOOLOR":155,"OP_NUMEQUAL":156,"OP_NUMEQUALVERIFY":157,"OP_NUMNOTEQUAL":158,"OP_LESSTHAN":159,"OP_GREATERTHAN":160,"OP_LESSTHANOREQUAL":161,"OP_GREATERTHANOREQUAL":162,"OP_MIN":163,"OP_MAX":164,"OP_WITHIN":165,"OP_RIPEMD160":166,"OP_SHA1":167,"OP_SHA256":168,"OP_HASH160":169,"OP_HASH256":170,"OP_CODESEPARATOR":171,"OP_CHECKSIG":172,"OP_CHECKSIGVERIFY":173,"OP_CHECKMULTISIG":174,"OP_CHECKMULTISIGVERIFY":175,"OP_NOP1":176,"OP_NOP2":177,"OP_CHECKLOCKTIMEVERIFY":177,"OP_NOP3":178,"OP_CHECKSEQUENCEVERIFY":178,"OP_NOP4":179,"OP_NOP5":180,"OP_NOP6":181,"OP_NOP7":182,"OP_NOP8":183,"OP_NOP9":184,"OP_NOP10":185,"OP_PUBKEYHASH":253,"OP_PUBKEY":254,"OP_INVALIDOPCODE":255}')},Fh8C:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("d+zW"),s=n("xmXb"),o=n("bEv/"),u=n("SqU0");function a(e,n){if(i(i.Array,e),e.length<1)return!1;const a=e[e.length-1];if(!t.isBuffer(a))return!1;const p=r.decompile(a);if(!p||0===p.length)return!1;const c=r.compile(e.slice(0,-1));return!(!u.input.check(c)||!u.output.check(p))||(!(!s.input.check(c,n)||!s.output.check(p))||!(!o.input.check(c)||!o.output.check(p)))}e.check=a,a.toJSON=()=>"witnessScriptHash input"}).call(this,n("HDXh").Buffer)},HKPE:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("9PLV");e.output=r},"I/fK":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG");function i(t){const e=r.decompile(t);return 1===e.length&&r.isCanonicalScriptSignature(e[0])}e.check=i,i.toJSON=()=>"pubKey input"},I6F5:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("xmXb"),s=n("SsB5"),o=n("bEv/"),u=n("SqU0"),a=n("IYV5"),p=n("HKPE"),c=n("CB62"),h=n("vR+u"),f={P2MS:"multisig",NONSTANDARD:"nonstandard",NULLDATA:"nulldata",P2PK:"pubkey",P2PKH:"pubkeyhash",P2SH:"scripthash",P2WPKH:"witnesspubkeyhash",P2WSH:"witnessscripthash",WITNESS_COMMITMENT:"witnesscommitment"};e.types=f,e.output=function(t){if(c.output.check(t))return f.P2WPKH;if(h.output.check(t))return f.P2WSH;if(u.output.check(t))return f.P2PKH;if(a.output.check(t))return f.P2SH;const e=r.decompile(t);if(!e)throw new TypeError("Invalid script");return i.output.check(e)?f.P2MS:o.output.check(e)?f.P2PK:p.output.check(e)?f.WITNESS_COMMITMENT:s.output.check(e)?f.NULLDATA:f.NONSTANDARD},e.input=function(t,e){const n=r.decompile(t);if(!n)throw new TypeError("Invalid script");return u.input.check(n)?f.P2PKH:a.input.check(n,e)?f.P2SH:i.input.check(n,e)?f.P2MS:o.input.check(n)?f.P2PK:f.NONSTANDARD},e.witness=function(t,e){const n=r.decompile(t);if(!n)throw new TypeError("Invalid script");return c.input.check(n)?f.P2WPKH:h.input.check(n,e)?f.P2WSH:f.NONSTANDARD}},IYV5:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("YxaY");e.input=r;const i=n("mBxT");e.output=i},IiU8:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("A6N3"),i=n("wmJG"),s=n("KfcP"),o=n("Edxu"),u=n("d+zW"),a=n("pQ88"),p=u.maybe(u.compile({compressed:i.maybe(i.Boolean),network:i.maybe(i.Network)}));class c{constructor(t,e,n){this.__D=t,this.__Q=e,this.lowR=!1,void 0===n&&(n={}),this.compressed=void 0===n.compressed||n.compressed,this.network=n.network||r.bitcoin,void 0!==e&&(this.__Q=s.pointCompress(e,this.compressed))}get privateKey(){return this.__D}get publicKey(){return this.__Q||(this.__Q=s.pointFromScalar(this.__D,this.compressed)),this.__Q}toWIF(){if(!this.__D)throw new Error("Missing private key");return a.encode(this.network.wif,this.__D,this.compressed)}sign(e,n){if(!this.__D)throw new Error("Missing private key");if(void 0===n&&(n=this.lowR),!1===n)return s.sign(e,this.__D);{let n=s.sign(e,this.__D);const r=t.alloc(32,0);let i=0;for(;n[0]>127;)i++,r.writeUIntLE(i,0,6),n=s.signWithEntropy(e,this.__D,r);return n}}verify(t,e){return s.verify(t,this.publicKey,e)}}function h(t,e){if(u(i.Buffer256bit,t),!s.isPrivate(t))throw new TypeError("Private key not in range [1, n)");return u(p,e),new c(t,void 0,e)}e.fromPrivateKey=h,e.fromPublicKey=function(t,e){return u(s.isPoint,t),u(p,e),new c(void 0,t,e)},e.fromWIF=function(t,e){const n=a.decode(t),s=n.version;if(i.Array(e)){if(!(e=e.filter(t=>s===t.wif).pop()))throw new Error("Unknown network version")}else if(e=e||r.bitcoin,s!==e.wif)throw new Error("Invalid network version");return h(n.privateKey,{compressed:n.compressed,network:e})},e.makeRandom=function(t){u(p,t),void 0===t&&(t={});const e=t.rng||o;let n;do{n=e(32),u(i.Buffer256bit,n)}while(!s.isPrivate(n));return h(n,t)}}).call(this,n("HDXh").Buffer)},Is0A:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("A6N3"),i=n("O5DG"),s=n("XKyx"),o=i.OPS,u=n("d+zW"),a=n("KfcP"),p=o.OP_RESERVED;function c(t,e){return t.length===e.length&&t.every((t,n)=>t.equals(e[n]))}e.p2ms=function(t,e){if(!(t.input||t.output||t.pubkeys&&void 0!==t.m||t.signatures))throw new TypeError("Not enough data");function n(t){return i.isCanonicalScriptSignature(t)||void 0!==(e.allowIncomplete&&t===o.OP_0)}e=Object.assign({validate:!0},e||{}),u({network:u.maybe(u.Object),m:u.maybe(u.Number),n:u.maybe(u.Number),output:u.maybe(u.Buffer),pubkeys:u.maybe(u.arrayOf(a.isPoint)),signatures:u.maybe(u.arrayOf(n)),input:u.maybe(u.Buffer)},t);const h={network:t.network||r.bitcoin};let f=[],l=!1;function d(t){l||(l=!0,f=i.decompile(t),h.m=f[0]-p,h.n=f[f.length-2]-p,h.pubkeys=f.slice(1,-2))}if(s.prop(h,"output",()=>{if(t.m&&h.n&&t.pubkeys)return i.compile([].concat(p+t.m,t.pubkeys,p+h.n,o.OP_CHECKMULTISIG))}),s.prop(h,"m",()=>{if(h.output)return d(h.output),h.m}),s.prop(h,"n",()=>{if(h.pubkeys)return h.pubkeys.length}),s.prop(h,"pubkeys",()=>{if(t.output)return d(t.output),h.pubkeys}),s.prop(h,"signatures",()=>{if(t.input)return i.decompile(t.input).slice(1)}),s.prop(h,"input",()=>{if(t.signatures)return i.compile([o.OP_0].concat(t.signatures))}),s.prop(h,"witness",()=>{if(h.input)return[]}),s.prop(h,"name",()=>{if(h.m&&h.n)return`p2ms(${h.m} of ${h.n})`}),e.validate){if(t.output){if(d(t.output),!u.Number(f[0]))throw new TypeError("Output is invalid");if(!u.Number(f[f.length-2]))throw new TypeError("Output is invalid");if(f[f.length-1]!==o.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(h.m<=0||h.n>16||h.m>h.n||h.n!==f.length-3)throw new TypeError("Output is invalid");if(!h.pubkeys.every(t=>a.isPoint(t)))throw new TypeError("Output is invalid");if(void 0!==t.m&&t.m!==h.m)throw new TypeError("m mismatch");if(void 0!==t.n&&t.n!==h.n)throw new TypeError("n mismatch");if(t.pubkeys&&!c(t.pubkeys,h.pubkeys))throw new TypeError("Pubkeys mismatch")}if(t.pubkeys){if(void 0!==t.n&&t.n!==t.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(h.n=t.pubkeys.length,h.n<h.m)throw new TypeError("Pubkey count cannot be less than m")}if(t.signatures){if(t.signatures.length<h.m)throw new TypeError("Not enough signatures provided");if(t.signatures.length>h.m)throw new TypeError("Too many signatures provided")}if(t.input){if(t.input[0]!==o.OP_0)throw new TypeError("Input is invalid");if(0===h.signatures.length||!h.signatures.every(n))throw new TypeError("Input has invalid signature(s)");if(t.signatures&&!c(t.signatures,h.signatures))throw new TypeError("Signature mismatch");if(void 0!==t.m&&t.m!==t.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(h,t)}},NPSo:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("n8MN"),i=n("n8MN"),s=n("lin5"),o=n("O5DG"),u=n("O5DG"),a=n("wmJG"),p=n("d+zW"),c=n("nU2i");function h(t){const e=t.length;return c.encodingLength(e)+e}const f=t.allocUnsafe(0),l=[],d=t.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),w=t.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),m=t.from("ffffffffffffffff","hex"),y={script:f,valueBuffer:m};class _{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(t,e){let n=0;function i(e){return n+=e,t.slice(n-e,n)}function s(){const e=t.readUInt32LE(n);return n+=4,e}function o(){const e=r.readUInt64LE(t,n);return n+=8,e}function u(){const e=c.decode(t,n);return n+=c.decode.bytes,e}function a(){return i(u())}function p(){const t=u(),e=[];for(let n=0;n<t;n++)e.push(a());return e}const h=new _;h.version=function(){const e=t.readInt32LE(n);return n+=4,e}();const f=t.readUInt8(n),d=t.readUInt8(n+1);let w=!1;f===_.ADVANCED_TRANSACTION_MARKER&&d===_.ADVANCED_TRANSACTION_FLAG&&(n+=2,w=!0);const m=u();for(let t=0;t<m;++t)h.ins.push({hash:i(32),index:s(),script:a(),sequence:s(),witness:l});const y=u();for(let t=0;t<y;++t)h.outs.push({value:o(),script:a()});if(w){for(let t=0;t<m;++t)h.ins[t].witness=p();if(!h.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(h.locktime=s(),e)return h;if(n!==t.length)throw new Error("Transaction has unexpected data");return h}static fromHex(e){return _.fromBuffer(t.from(e,"hex"),!1)}static isCoinbaseHash(t){p(a.Hash256bit,t);for(let e=0;e<32;++e)if(0!==t[e])return!1;return!0}isCoinbase(){return 1===this.ins.length&&_.isCoinbaseHash(this.ins[0].hash)}addInput(t,e,n,r){return p(a.tuple(a.Hash256bit,a.UInt32,a.maybe(a.UInt32),a.maybe(a.Buffer)),arguments),a.Null(n)&&(n=_.DEFAULT_SEQUENCE),this.ins.push({hash:t,index:e,script:r||f,sequence:n,witness:l})-1}addOutput(t,e){return p(a.tuple(a.Buffer,a.Satoshi),arguments),this.outs.push({script:t,value:e})-1}hasWitnesses(){return this.ins.some(t=>0!==t.witness.length)}weight(){return 3*this.__byteLength(!1)+this.__byteLength(!0)}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(){return this.__byteLength(!0)}clone(){const t=new _;return t.version=this.version,t.locktime=this.locktime,t.ins=this.ins.map(t=>({hash:t.hash,index:t.index,script:t.script,sequence:t.sequence,witness:t.witness})),t.outs=this.outs.map(t=>({script:t.script,value:t.value})),t}hashForSignature(e,n,r){if(p(a.tuple(a.UInt32,a.Buffer,a.Number),arguments),e>=this.ins.length)return w;const i=o.compile(o.decompile(n).filter(t=>t!==u.OPS.OP_CODESEPARATOR)),c=this.clone();if((31&r)===_.SIGHASH_NONE)c.outs=[],c.ins.forEach((t,n)=>{n!==e&&(t.sequence=0)});else if((31&r)===_.SIGHASH_SINGLE){if(e>=this.outs.length)return w;c.outs.length=e+1;for(let t=0;t<e;t++)c.outs[t]=y;c.ins.forEach((t,n)=>{n!==e&&(t.sequence=0)})}r&_.SIGHASH_ANYONECANPAY?(c.ins=[c.ins[e]],c.ins[0].script=i):(c.ins.forEach(t=>{t.script=f}),c.ins[e].script=i);const h=t.allocUnsafe(c.__byteLength(!1)+4);return h.writeInt32LE(r,h.length-4),c.__toBuffer(h,0,!1),s.hash256(h)}hashForWitnessV0(e,n,i,o){p(a.tuple(a.UInt32,a.Buffer,a.Satoshi,a.UInt32),arguments);let u=t.from([]),f=0;function l(t){f+=t.copy(u,f)}function w(t){f=u.writeUInt32LE(t,f)}function m(t){f=r.writeUInt64LE(u,t,f)}function y(t){var e;e=t.length,c.encode(e,u,f),f+=c.encode.bytes,l(t)}let g=d,S=d,O=d;if(o&_.SIGHASH_ANYONECANPAY||(u=t.allocUnsafe(36*this.ins.length),f=0,this.ins.forEach(t=>{l(t.hash),w(t.index)}),S=s.hash256(u)),o&_.SIGHASH_ANYONECANPAY||(31&o)===_.SIGHASH_SINGLE||(31&o)===_.SIGHASH_NONE||(u=t.allocUnsafe(4*this.ins.length),f=0,this.ins.forEach(t=>{w(t.sequence)}),O=s.hash256(u)),(31&o)!==_.SIGHASH_SINGLE&&(31&o)!==_.SIGHASH_NONE){const e=this.outs.reduce((t,e)=>t+8+h(e.script),0);u=t.allocUnsafe(e),f=0,this.outs.forEach(t=>{m(t.value),y(t.script)}),g=s.hash256(u)}else if((31&o)===_.SIGHASH_SINGLE&&e<this.outs.length){const n=this.outs[e];u=t.allocUnsafe(8+h(n.script)),f=0,m(n.value),y(n.script),g=s.hash256(u)}u=t.allocUnsafe(156+h(n)),f=0;const E=this.ins[e];return w(this.version),l(S),l(O),l(E.hash),w(E.index),y(n),m(i),w(E.sequence),l(g),w(this.locktime),w(o),s.hash256(u)}getHash(e){return e&&this.isCoinbase()?t.alloc(32,0):s.hash256(this.__toBuffer(void 0,void 0,e))}getId(){return i.reverseBuffer(this.getHash(!1)).toString("hex")}toBuffer(t,e){return this.__toBuffer(t,e,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(t,e){p(a.tuple(a.Number,a.Buffer),arguments),this.ins[t].script=e}setWitness(t,e){p(a.tuple(a.Number,[a.Buffer]),arguments),this.ins[t].witness=e}__byteLength(t){const e=t&&this.hasWitnesses();return(e?10:8)+c.encodingLength(this.ins.length)+c.encodingLength(this.outs.length)+this.ins.reduce((t,e)=>t+40+h(e.script),0)+this.outs.reduce((t,e)=>t+8+h(e.script),0)+(e?this.ins.reduce((t,e)=>t+function(t){const e=t.length;return c.encodingLength(e)+t.reduce((t,e)=>t+h(e),0)}(e.witness),0):0)}__toBuffer(e,n,i){e||(e=t.allocUnsafe(this.__byteLength(i)));let s=n||0;function o(t){s+=t.copy(e,s)}function u(t){s=e.writeUInt8(t,s)}function a(t){s=e.writeUInt32LE(t,s)}function p(t){c.encode(t,e,s),s+=c.encode.bytes}function h(t){p(t.length),o(t)}var f;f=this.version,s=e.writeInt32LE(f,s);const l=i&&this.hasWitnesses();return l&&(u(_.ADVANCED_TRANSACTION_MARKER),u(_.ADVANCED_TRANSACTION_FLAG)),p(this.ins.length),this.ins.forEach(t=>{o(t.hash),a(t.index),h(t.script),a(t.sequence)}),p(this.outs.length),this.outs.forEach(t=>{!function(t){return void 0!==t.value}(t)?o(t.valueBuffer):function(t){s=r.writeUInt64LE(e,t,s)}(t.value),h(t.script)}),l&&this.ins.forEach(t=>{!function(t){p(t.length),t.forEach(h)}(t.witness)}),a(this.locktime),void 0!==n?e.slice(n,s):e}}_.DEFAULT_SEQUENCE=4294967295,_.SIGHASH_ALL=1,_.SIGHASH_NONE=2,_.SIGHASH_SINGLE=3,_.SIGHASH_ANYONECANPAY=128,_.ADVANCED_TRANSACTION_MARKER=0,_.ADVANCED_TRANSACTION_FLAG=1,e.Transaction=_}).call(this,n("HDXh").Buffer)},Nw9z:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("O5DG");function s(t){const e=r.decompile(t);return 2===e.length&&r.isCanonicalPubKey(e[0])&&e[1]===i.OPS.OP_CHECKSIG}e.check=s,s.toJSON=()=>"pubKey output"},O5DG:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("dfgu"),i=n("PHfo"),s=n("wmJG"),o=n("zRCy"),u=n("KfcP"),a=n("FxS5"),p=n("d+zW");e.OPS=n("E0BK");const c=n("yX9u"),h=e.OPS.OP_RESERVED;function f(t){return s.Buffer(t)||function(t){return s.Number(t)&&(t===e.OPS.OP_0||t>=e.OPS.OP_1&&t<=e.OPS.OP_16||t===e.OPS.OP_1NEGATE)}(t)}function l(t){return s.Array(t)&&t.every(f)}function d(t){return 0===t.length?e.OPS.OP_0:1===t.length?t[0]>=1&&t[0]<=16?h+t[0]:129===t[0]?e.OPS.OP_1NEGATE:void 0:void 0}function w(e){return t.isBuffer(e)}function m(e){return t.isBuffer(e)}function y(e){if(w(e))return e;p(s.Array,e);const n=e.reduce((t,e)=>m(e)?1===e.length&&void 0!==d(e)?t+1:t+a.encodingLength(e.length)+e.length:t+1,0),r=t.allocUnsafe(n);let i=0;if(e.forEach(t=>{if(m(t)){const e=d(t);if(void 0!==e)return r.writeUInt8(e,i),void(i+=1);i+=a.encode(r,t.length,i),t.copy(r,i),i+=t.length}else r.writeUInt8(t,i),i+=1}),i!==r.length)throw new Error("Could not decode chunks");return r}function _(t){if(n=t,s.Array(n))return t;var n;p(s.Buffer,t);const r=[];let i=0;for(;i<t.length;){const n=t[i];if(n>e.OPS.OP_0&&n<=e.OPS.OP_PUSHDATA4){const e=a.decode(t,i);if(null===e)return null;if((i+=e.size)+e.number>t.length)return null;const n=t.slice(i,i+e.number);i+=e.number;const s=d(n);void 0!==s?r.push(s):r.push(n)}else r.push(n),i+=1}return r}function g(t){const e=-129&t;return e>0&&e<4}e.isPushOnly=l,e.compile=y,e.decompile=_,e.toASM=function(t){return w(t)&&(t=_(t)),t.map(t=>{if(m(t)){const e=d(t);if(void 0===e)return t.toString("hex");t=e}return c[t]}).join(" ")},e.fromASM=function(n){return p(s.String,n),y(n.split(" ").map(n=>void 0!==e.OPS[n]?e.OPS[n]:(p(s.Hex,n),t.from(n,"hex"))))},e.toStack=function(n){return n=_(n),p(l,n),n.map(n=>m(n)?n:n===e.OPS.OP_0?t.allocUnsafe(0):r.encode(n-h))},e.isCanonicalPubKey=function(t){return u.isPoint(t)},e.isDefinedHashType=g,e.isCanonicalScriptSignature=function(e){return!!t.isBuffer(e)&&(!!g(e[e.length-1])&&o.check(e.slice(0,-1)))},e.number=r,e.signature=i}).call(this,n("HDXh").Buffer)},PHfo:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("wmJG"),i=n("zRCy"),s=n("d+zW"),o=t.alloc(1,0);function u(e){let n=0;for(;0===e[n];)++n;return n===e.length?o:128&(e=e.slice(n))[0]?t.concat([o,e],1+e.length):e}function a(e){0===e[0]&&(e=e.slice(1));const n=t.alloc(32,0),r=Math.max(0,32-e.length);return e.copy(n,r),n}e.decode=function(e){const n=e.readUInt8(e.length-1),r=-129&n;if(r<=0||r>=4)throw new Error("Invalid hashType "+n);const s=i.decode(e.slice(0,-1)),o=a(s.r),u=a(s.s);return{signature:t.concat([o,u],64),hashType:n}},e.encode=function(e,n){s({signature:r.BufferN(64),hashType:r.UInt8},{signature:e,hashType:n});const o=-129&n;if(o<=0||o>=4)throw new Error("Invalid hashType "+n);const a=t.allocUnsafe(1);a.writeUInt8(n,0);const p=u(e.slice(0,32)),c=u(e.slice(32,64));return t.concat([i.encode(p,c),a])}}).call(this,n("HDXh").Buffer)},QDNB:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("n8MN"),i=n("lin5"),s=n("NPSo"),o=n("wmJG"),u=n("CjOr"),a=n("d+zW"),p=n("nU2i"),c=new TypeError("Cannot compute merkle root for zero transactions"),h=new TypeError("Cannot compute witness commit for non-segwit block");class f{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(t){if(t.length<80)throw new Error("Buffer too small (< 80 bytes)");let e=0;const n=n=>(e+=n,t.slice(e-n,e)),r=()=>{const n=t.readUInt32LE(e);return e+=4,n},i=new f;if(i.version=(()=>{const n=t.readInt32LE(e);return e+=4,n})(),i.prevHash=n(32),i.merkleRoot=n(32),i.timestamp=r(),i.bits=r(),i.nonce=r(),80===t.length)return i;const o=()=>{const n=s.Transaction.fromBuffer(t.slice(e),!0);return e+=n.byteLength(),n},u=(()=>{const n=p.decode(t,e);return e+=p.decode.bytes,n})();i.transactions=[];for(let t=0;t<u;++t){const t=o();i.transactions.push(t)}const a=i.getWitnessCommit();return a&&(i.witnessCommit=a),i}static fromHex(e){return f.fromBuffer(t.from(e,"hex"))}static calculateTarget(e){const n=((4278190080&e)>>24)-3,r=8388607&e,i=t.alloc(32,0);return i.writeUIntBE(r,29-n,3),i}static calculateMerkleRoot(e,n){if(a([{getHash:o.Function}],e),0===e.length)throw c;if(n&&!l(e))throw h;const r=e.map(t=>t.getHash(n)),s=u(r,i.hash256);return n?i.hash256(t.concat([s,e[0].ins[0].witness[0]])):s}getWitnessCommit(){if(!l(this.transactions))return null;const e=this.transactions[0].outs.filter(e=>e.script.slice(0,6).equals(t.from("6a24aa21a9ed","hex"))).map(t=>t.script.slice(6,38));if(0===e.length)return null;const n=e[e.length-1];return n instanceof t&&32===n.length?n:null}hasWitnessCommit(){return this.witnessCommit instanceof t&&32===this.witnessCommit.length||null!==this.getWitnessCommit()}hasWitness(){return(t=this.transactions)instanceof Array&&t.some(t=>"object"==typeof t&&t.ins instanceof Array&&t.ins.some(t=>"object"==typeof t&&t.witness instanceof Array&&t.witness.length>0));var t}byteLength(t){return t||!this.transactions?80:80+p.encodingLength(this.transactions.length)+this.transactions.reduce((t,e)=>t+e.byteLength(),0)}getHash(){return i.hash256(this.toBuffer(!0))}getId(){return r.reverseBuffer(this.getHash()).toString("hex")}getUTCDate(){const t=new Date(0);return t.setUTCSeconds(this.timestamp),t}toBuffer(e){const n=t.allocUnsafe(this.byteLength(e));let r=0;const i=t=>{t.copy(n,r),r+=t.length},s=t=>{n.writeUInt32LE(t,r),r+=4};var o;return o=this.version,n.writeInt32LE(o,r),r+=4,i(this.prevHash),i(this.merkleRoot),s(this.timestamp),s(this.bits),s(this.nonce),e||!this.transactions?n:(p.encode(this.transactions.length,n,r),r+=p.encode.bytes,this.transactions.forEach(t=>{const e=t.byteLength();t.toBuffer(n,r),r+=e}),n)}toHex(t){return this.toBuffer(t).toString("hex")}checkTxRoots(){const t=this.hasWitnessCommit();return!(!t&&this.hasWitness())&&(this.__checkMerkleRoot()&&(!t||this.__checkWitnessCommit()))}checkProofOfWork(){const t=r.reverseBuffer(this.getHash()),e=f.calculateTarget(this.bits);return t.compare(e)<=0}__checkMerkleRoot(){if(!this.transactions)throw c;const t=f.calculateMerkleRoot(this.transactions);return 0===this.merkleRoot.compare(t)}__checkWitnessCommit(){if(!this.transactions)throw c;if(!this.hasWitnessCommit())throw h;const t=f.calculateMerkleRoot(this.transactions,!0);return 0===this.witnessCommit.compare(t)}}function l(t){return t instanceof Array&&t[0]&&t[0].ins&&t[0].ins instanceof Array&&t[0].ins[0]&&t[0].ins[0].witness&&t[0].ins[0].witness instanceof Array&&t[0].ins[0].witness.length>0}e.Block=f}).call(this,n("HDXh").Buffer)},Re6D:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("DIuF"),i=n("NR72"),s=n("oosv"),o=n("lMJ2"),u=n("n8MN"),a=n("lin5"),p=n("IiU8"),c=n("A6N3"),h=n("iRDL"),f=n("O5DG"),l=n("NPSo"),d={network:c.bitcoin,maximumFeeRate:5e3};class w{constructor(t={},e=new r.Psbt(new y)){this.data=e,this.opts=Object.assign({},d,t),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx},0===this.data.inputs.length&&this.setVersion(2);const n=(t,e,n,r)=>Object.defineProperty(t,e,{enumerable:n,writable:r});n(this,"__CACHE",!1,!0),n(this,"opts",!1,!0)}static fromBase64(e,n={}){const r=t.from(e,"base64");return this.fromBuffer(r,n)}static fromHex(e,n={}){const r=t.from(e,"hex");return this.fromBuffer(r,n)}static fromBuffer(t,e={}){const n=r.Psbt.fromBuffer(t,m),i=new w(e,n);var s,o;return s=i.__CACHE.__TX,o=i.__CACHE,s.ins.forEach(t=>{H(o,t)}),i}get inputCount(){return this.data.inputs.length}combine(...t){return this.data.combine(...t.map(t=>t.data)),this}clone(){const t=w.fromBuffer(this.data.toBuffer());return t.opts=JSON.parse(JSON.stringify(this.opts)),t}setMaximumFeeRate(t){T(t),this.opts.maximumFeeRate=t}setVersion(t){T(t),k(this.data.inputs,"setVersion");const e=this.__CACHE;return e.__TX.version=t,e.__EXTRACTED_TX=void 0,this}setLocktime(t){T(t),k(this.data.inputs,"setLocktime");const e=this.__CACHE;return e.__TX.locktime=t,e.__EXTRACTED_TX=void 0,this}setInputSequence(t,e){T(e),k(this.data.inputs,"setInputSequence");const n=this.__CACHE;if(n.__TX.ins.length<=t)throw new Error("Input index too high");return n.__TX.ins[t].sequence=e,n.__EXTRACTED_TX=void 0,this}addInputs(t){return t.forEach(t=>this.addInput(t)),this}addInput(t){k(this.data.inputs,"addInput");const e=this.__CACHE;this.data.addInput(t),H(e,e.__TX.ins[e.__TX.ins.length-1]);const n=this.data.inputs.length-1,r=this.data.inputs[n];return r.nonWitnessUtxo&&W(this.__CACHE,r,n),e.__FEE=void 0,e.__FEE_RATE=void 0,e.__EXTRACTED_TX=void 0,this}addOutputs(t){return t.forEach(t=>this.addOutput(t)),this}addOutput(t){k(this.data.inputs,"addOutput");const{address:e}=t;if("string"==typeof e){const{network:n}=this.opts,r=o.toOutputScript(e,n);t=Object.assign(t,{script:r})}const n=this.__CACHE;return this.data.addOutput(t),n.__FEE=void 0,n.__FEE_RATE=void 0,n.__EXTRACTED_TX=void 0,this}extractTransaction(t){if(!this.data.inputs.every(g))throw new Error("Not finalized");const e=this.__CACHE;if(t||function(t,e,n){const r=e.__FEE_RATE||t.getFeeRate(),i=e.__EXTRACTED_TX.virtualSize(),s=r*i;if(r>=n.maximumFeeRate)throw new Error(`Warning: You are paying around ${(s/1e8).toFixed(8)} in `+`fees, which is ${r} satoshi per byte for a transaction `+`with a VSize of ${i} bytes (segwit counted as 0.25 byte per `+"byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.")}(this,e,this.opts),e.__EXTRACTED_TX)return e.__EXTRACTED_TX;const n=e.__TX.clone();return K(this.data.inputs,n,e,!0),n}getFeeRate(){return C("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return C("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return s.checkForInput(this.data.inputs,0),M(this.data.inputs.length).forEach(t=>this.finalizeInput(t)),this}finalizeInput(t){const e=s.checkForInput(this.data.inputs,t),{script:n,isP2SH:r,isP2WSH:i,isSegwit:o}=function(t,e,n){const r=n.__TX,i={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(i.isP2SH=!!e.redeemScript,i.isP2WSH=!!e.witnessScript,e.witnessScript)i.script=e.witnessScript;else if(e.redeemScript)i.script=e.redeemScript;else if(e.nonWitnessUtxo){const s=G(n,e,t),o=r.ins[t].index;i.script=s.outs[o].script}else e.witnessUtxo&&(i.script=e.witnessUtxo.script);(e.witnessScript||P(i.script))&&(i.isSegwit=!0);return i}(t,e,this.__CACHE);if(!n)throw new Error(`No script found for input #${t}`);const u=function(t){return P(t)?"witnesspubkeyhash":b(t)?"pubkeyhash":O(t)?"multisig":E(t)?"pubkey":"nonstandard"}(n);if(!function(t,e,n){switch(n){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return _(1,t.partialSig);case"multisig":return _(h.p2ms({output:e}).m,t.partialSig);default:return!1}}(e,n,u))throw new Error(`Can not finalize input #${t}`);!function(t){if(!t.sighashType||!t.partialSig)return;const{partialSig:e,sighashType:n}=t;e.forEach(t=>{const{hashType:e}=f.signature.decode(t.signature);if(n!==e)throw new Error("Signature sighash does not match input sighash type")})}(e);const{finalScriptSig:a,finalScriptWitness:p}=function(t,e,n,r,i,s){let o,u;const a=function(t,e,n){let r;switch(e){case"multisig":const e=function(t,e){return h.p2ms({output:t}).pubkeys.map(t=>(e.filter(e=>e.pubkey.equals(t))[0]||{}).signature).filter(t=>!!t)}(t,n);r=h.p2ms({output:t,signatures:e});break;case"pubkey":r=h.p2pk({output:t,signature:n[0].signature});break;case"pubkeyhash":r=h.p2pkh({output:t,pubkey:n[0].pubkey,signature:n[0].signature});break;case"witnesspubkeyhash":r=h.p2wpkh({output:t,pubkey:n[0].pubkey,signature:n[0].signature})}return r}(t,e,n),p=s?h.p2wsh({redeem:a}):null,c=i?h.p2sh({redeem:p||a}):null;r?(u=L(p?p.witness:a.witness),c&&(o=c.input)):o=c?c.input:a.input;return{finalScriptSig:o,finalScriptWitness:u}}(n,u,e.partialSig,o,r,i);if(a&&this.data.updateInput(t,{finalScriptSig:a}),p&&this.data.updateInput(t,{finalScriptWitness:p}),!a&&!p)throw new Error(`Unknown error finalizing input #${t}`);return this.data.clearFinalizedInput(t),this}validateSignaturesOfAllInputs(){return s.checkForInput(this.data.inputs,0),M(this.data.inputs.length).map(t=>this.validateSignaturesOfInput(t)).reduce((t,e)=>!0===e&&t,!0)}validateSignaturesOfInput(t,e){const n=this.data.inputs[t],r=(n||{}).partialSig;if(!n||!r||r.length<1)throw new Error("No signatures to validate");const i=e?r.filter(t=>t.pubkey.equals(e)):r;if(i.length<1)throw new Error("No signatures for this pubkey");const s=[];let o,u,a;for(const e of i){const r=f.signature.decode(e.signature),{hash:i,script:c}=a!==r.hashType?B(t,Object.assign({},n,{sighashType:r.hashType}),this.__CACHE):{hash:o,script:u};a=r.hashType,o=i,u=c,N(e.pubkey,c,"verify");const h=p.fromPublicKey(e.pubkey);s.push(h.verify(i,r.signature))}return s.every(t=>!0===t)}signAllInputsHD(t,e=[l.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");const n=[];for(const r of M(this.data.inputs.length))try{this.signInputHD(r,t,e),n.push(!0)}catch(t){n.push(!1)}if(n.every(t=>!1===t))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(t,e=[l.Transaction.SIGHASH_ALL]){return new Promise((n,r)=>{if(!t||!t.publicKey||!t.fingerprint)return r(new Error("Need HDSigner to sign input"));const i=[],s=[];for(const n of M(this.data.inputs.length))s.push(this.signInputHDAsync(n,t,e).then(()=>{i.push(!0)},()=>{i.push(!1)}));return Promise.all(s).then(()=>{if(i.every(t=>!1===t))return r(new Error("No inputs were signed"));n()})})}signInputHD(t,e,n=[l.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");return R(t,this.data.inputs,e).forEach(e=>this.signInput(t,e,n)),this}signInputHDAsync(t,e,n=[l.Transaction.SIGHASH_ALL]){return new Promise((r,i)=>{if(!e||!e.publicKey||!e.fingerprint)return i(new Error("Need HDSigner to sign input"));const s=R(t,this.data.inputs,e).map(e=>this.signInputAsync(t,e,n));return Promise.all(s).then(()=>{r()}).catch(i)})}signAllInputs(t,e=[l.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const n=[];for(const r of M(this.data.inputs.length))try{this.signInput(r,t,e),n.push(!0)}catch(t){n.push(!1)}if(n.every(t=>!1===t))throw new Error("No inputs were signed");return this}signAllInputsAsync(t,e=[l.Transaction.SIGHASH_ALL]){return new Promise((n,r)=>{if(!t||!t.publicKey)return r(new Error("Need Signer to sign input"));const i=[],s=[];for(const[n]of this.data.inputs.entries())s.push(this.signInputAsync(n,t,e).then(()=>{i.push(!0)},()=>{i.push(!1)}));return Promise.all(s).then(()=>{if(i.every(t=>!1===t))return r(new Error("No inputs were signed"));n()})})}signInput(t,e,n=[l.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const{hash:r,sighashType:i}=D(this.data.inputs,t,e.publicKey,this.__CACHE,n),s=[{pubkey:e.publicKey,signature:f.signature.encode(e.sign(r),i)}];return this.data.updateInput(t,{partialSig:s}),this}signInputAsync(t,e,n=[l.Transaction.SIGHASH_ALL]){return new Promise((r,i)=>{if(!e||!e.publicKey)return i(new Error("Need Signer to sign input"));const{hash:s,sighashType:o}=D(this.data.inputs,t,e.publicKey,this.__CACHE,n);Promise.resolve(e.sign(s)).then(n=>{const i=[{pubkey:e.publicKey,signature:f.signature.encode(n,o)}];this.data.updateInput(t,{partialSig:i}),r()})})}toBuffer(){return this.data.toBuffer()}toHex(){return this.data.toHex()}toBase64(){return this.data.toBase64()}updateGlobal(t){return this.data.updateGlobal(t),this}updateInput(t,e){return this.data.updateInput(t,e),e.nonWitnessUtxo&&W(this.__CACHE,this.data.inputs[t],t),this}updateOutput(t,e){return this.data.updateOutput(t,e),this}addUnknownKeyValToGlobal(t){return this.data.addUnknownKeyValToGlobal(t),this}addUnknownKeyValToInput(t,e){return this.data.addUnknownKeyValToInput(t,e),this}addUnknownKeyValToOutput(t,e){return this.data.addUnknownKeyValToOutput(t,e),this}clearFinalizedInput(t){return this.data.clearFinalizedInput(t),this}}e.Psbt=w;const m=t=>new y(t);class y{constructor(e=t.from([2,0,0,0,0,0,0,0,0,0])){this.tx=l.Transaction.fromBuffer(e),function(t){if(!t.ins.every(t=>t.script&&0===t.script.length&&t.witness&&0===t.witness.length))throw new Error("Format Error: Transaction ScriptSigs are not empty")}(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(e){if(void 0===e.hash||void 0===e.index||!t.isBuffer(e.hash)&&"string"!=typeof e.hash||"number"!=typeof e.index)throw new Error("Error adding input.");const n="string"==typeof e.hash?u.reverseBuffer(t.from(e.hash,"hex")):e.hash;this.tx.addInput(n,e.index,e.sequence)}addOutput(e){if(void 0===e.script||void 0===e.value||!t.isBuffer(e.script)||"number"!=typeof e.value)throw new Error("Error adding output.");this.tx.addOutput(e.script,e.value)}toBuffer(){return this.tx.toBuffer()}}function _(t,e){if(!e)return!1;if(e.length>t)throw new Error("Too many signatures");return e.length===t}function g(t){return!!t.finalScriptSig||!!t.finalScriptWitness}function S(t){return e=>{try{return t({output:e}),!0}catch(t){return!1}}}const O=S(h.p2ms),E=S(h.p2pk),b=S(h.p2pkh),P=S(h.p2wpkh),v=S(h.p2wsh);function T(t){if("number"!=typeof t||t!==Math.floor(t)||t>4294967295||t<0)throw new Error("Invalid 32 bit integer")}function k(e,n){e.forEach(e=>{let r=!1,i=[];if(0===(e.partialSig||[]).length){if(!e.finalScriptSig&&!e.finalScriptWitness)return;i=function(e){const n=e.finalScriptSig&&f.decompile(e.finalScriptSig)||[],r=e.finalScriptWitness&&f.decompile(e.finalScriptWitness)||[];return n.concat(r).filter(e=>t.isBuffer(e)&&f.isCanonicalScriptSignature(e)).map(t=>({signature:t}))}(e)}else i=e.partialSig;if(i.forEach(t=>{const{hashType:e}=f.signature.decode(t.signature),i=[];switch(e&l.Transaction.SIGHASH_ANYONECANPAY&&i.push("addInput"),31&e){case l.Transaction.SIGHASH_ALL:break;case l.Transaction.SIGHASH_SINGLE:case l.Transaction.SIGHASH_NONE:i.push("addOutput"),i.push("setInputSequence")}-1===i.indexOf(n)&&(r=!0)}),r)throw new Error("Can not modify transaction, signatures exist.")})}function N(t,e,n){const r=a.hash160(t),i=f.decompile(e);if(null===i)throw new Error("Unknown script error");if(!i.some(e=>"number"!=typeof e&&(e.equals(t)||e.equals(r))))throw new Error(`Can not ${n} for this input with the key ${t.toString("hex")}`)}function H(e,n){const r=u.reverseBuffer(t.from(n.hash)).toString("hex")+":"+n.index;if(e.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");e.__TX_IN_CACHE[r]=1}function I(t,e){return(n,r,i)=>{const s=t({redeem:{output:i}}).output;if(!r.equals(s))throw new Error(`${e} for input #${n} doesn't match the scriptPubKey in the prevout`)}}const A=I(h.p2sh,"Redeem script"),U=I(h.p2wsh,"Witness script");function C(t,e,n,r){if(!n.every(g))throw new Error(`PSBT must be finalized to calculate ${e}`);if("__FEE_RATE"===t&&r.__FEE_RATE)return r.__FEE_RATE;if("__FEE"===t&&r.__FEE)return r.__FEE;let i,s=!0;return r.__EXTRACTED_TX?(i=r.__EXTRACTED_TX,s=!1):i=r.__TX.clone(),K(n,i,r,s),"__FEE_RATE"===t?r.__FEE_RATE:"__FEE"===t?r.__FEE:void 0}function D(t,e,n,r,i){const o=s.checkForInput(t,e),{hash:u,sighashType:a,script:p}=B(e,o,r,i);return N(n,p,"sign"),{hash:u,sighashType:a}}function B(t,e,n,r){const i=n.__TX,s=e.sighashType||l.Transaction.SIGHASH_ALL;if(r&&r.indexOf(s)<0){const t=function(t){let e=t&l.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(31&t){case l.Transaction.SIGHASH_ALL:e+="SIGHASH_ALL";break;case l.Transaction.SIGHASH_SINGLE:e+="SIGHASH_SINGLE";break;case l.Transaction.SIGHASH_NONE:e+="SIGHASH_NONE"}return e}(s);throw new Error("Sighash type is not allowed. Retry the sign method passing the "+`sighashTypes array of whitelisted types. Sighash type: ${t}`)}let o,u;if(e.nonWitnessUtxo){const r=G(n,e,t),a=i.ins[t].hash,p=r.getHash();if(!a.equals(p))throw new Error(`Non-witness UTXO hash for input #${t} doesn't match the hash specified in the prevout`);const c=i.ins[t].index,f=r.outs[c];if(e.redeemScript?(A(t,f.script,e.redeemScript),u=e.redeemScript):u=f.script,v(u)){if(!e.witnessScript)throw new Error("Segwit input needs witnessScript if not P2WPKH");U(t,u,e.witnessScript),o=i.hashForWitnessV0(t,e.witnessScript,f.value,s),u=e.witnessScript}else if(P(u)){const e=h.p2pkh({hash:u.slice(2)}).output;o=i.hashForWitnessV0(t,e,f.value,s)}else o=i.hashForSignature(t,u,s)}else{if(!e.witnessUtxo)throw new Error("Need a Utxo input item for signing");{let n;if(e.redeemScript?(A(t,e.witnessUtxo.script,e.redeemScript),n=e.redeemScript):n=e.witnessUtxo.script,P(n)){const r=h.p2pkh({hash:n.slice(2)}).output;o=i.hashForWitnessV0(t,r,e.witnessUtxo.value,s),u=n}else{if(!v(n))throw new Error(`Input #${t} has witnessUtxo but non-segwit script: `+`${n.toString("hex")}`);if(!e.witnessScript)throw new Error("Segwit input needs witnessScript if not P2WPKH");U(t,n,e.witnessScript),o=i.hashForWitnessV0(t,e.witnessScript,e.witnessUtxo.value,s),u=e.witnessScript}}}return{script:u,sighashType:s,hash:o}}function R(t,e,n){const r=s.checkForInput(e,t);if(!r.bip32Derivation||0===r.bip32Derivation.length)throw new Error("Need bip32Derivation to sign with HD");const i=r.bip32Derivation.map(t=>t.masterFingerprint.equals(n.fingerprint)?t:void 0).filter(t=>!!t);if(0===i.length)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return i.map(t=>{const e=n.derivePath(t.path);if(!t.pubkey.equals(e.publicKey))throw new Error("pubkey did not match bip32Derivation");return e})}function x(t){let e=0;function n(){const n=i.decode(t,e);return e+=i.decode.bytes,n}function r(){return r=n(),e+=r,t.slice(e-r,e);var r}return function(){const t=n(),e=[];for(let n=0;n<t;n++)e.push(r());return e}()}function L(e){let n=t.allocUnsafe(0);function r(e){const r=n.length,s=i.encodingLength(e);n=t.concat([n,t.allocUnsafe(s)]),i.encode(e,n,r)}function s(e){r(e.length),function(e){n=t.concat([n,t.from(e)])}(e)}var o;return r((o=e).length),o.forEach(s),n}function W(t,e,n){t.__NON_WITNESS_UTXO_BUF_CACHE[n]=e.nonWitnessUtxo;const r=l.Transaction.fromBuffer(e.nonWitnessUtxo);t.__NON_WITNESS_UTXO_TX_CACHE[n]=r;const i=t,s=n;delete e.nonWitnessUtxo,Object.defineProperty(e,"nonWitnessUtxo",{enumerable:!0,get(){const t=i.__NON_WITNESS_UTXO_BUF_CACHE[s],e=i.__NON_WITNESS_UTXO_TX_CACHE[s];if(void 0!==t)return t;{const t=e.toBuffer();return i.__NON_WITNESS_UTXO_BUF_CACHE[s]=t,t}},set(t){i.__NON_WITNESS_UTXO_BUF_CACHE[s]=t}})}function K(t,e,n,r){let i=0;t.forEach((t,s)=>{if(r&&t.finalScriptSig&&(e.ins[s].script=t.finalScriptSig),r&&t.finalScriptWitness&&(e.ins[s].witness=x(t.finalScriptWitness)),t.witnessUtxo)i+=t.witnessUtxo.value;else if(t.nonWitnessUtxo){const r=G(n,t,s),o=e.ins[s].index,u=r.outs[o];i+=u.value}});const s=e.outs.reduce((t,e)=>t+e.value,0),o=i-s;if(o<0)throw new Error("Outputs are spending more than Inputs");const u=e.virtualSize();n.__FEE=o,n.__EXTRACTED_TX=e,n.__FEE_RATE=Math.floor(o/u)}function G(t,e,n){const r=t.__NON_WITNESS_UTXO_TX_CACHE;return r[n]||W(t,e,n),r[n]}function M(t){return[...Array(t).keys()]}}).call(this,n("HDXh").Buffer)},SqU0:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("WkSN");e.input=r;const i=n("YgBC");e.output=i},SsB5:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=r.OPS;function s(t){const e=r.compile(t);return e.length>1&&e[0]===i.OP_RETURN}e.check=s,s.toJSON=()=>"null data output";const o={check:s};e.output=o},TJSY:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("O5DG");function s(t){const e=r.compile(t);return 22===e.length&&e[0]===i.OPS.OP_0&&20===e[1]}e.check=s,s.toJSON=()=>"Witness pubKeyHash output"},W89i:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("A6N3"),i=n("O5DG"),s=n("XKyx"),o=n("d+zW"),u=i.OPS;e.p2data=function(t,e){if(!t.data&&!t.output)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),o({network:o.maybe(o.Object),output:o.maybe(o.Buffer),data:o.maybe(o.arrayOf(o.Buffer))},t);const n={name:"embed",network:t.network||r.bitcoin};if(s.prop(n,"output",()=>{if(t.data)return i.compile([u.OP_RETURN].concat(t.data))}),s.prop(n,"data",()=>{if(t.output)return i.decompile(t.output).slice(1)}),e.validate&&t.output){const e=i.decompile(t.output);if(e[0]!==u.OP_RETURN)throw new TypeError("Output is invalid");if(!e.slice(1).every(o.Buffer))throw new TypeError("Output is invalid");if(t.data&&!function(t,e){return t.length===e.length&&t.every((t,n)=>t.equals(e[n]))}(t.data,n.data))throw new TypeError("Data mismatch")}return Object.assign(n,t)}},WdoV:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("sHUq");e.bip32=r;const i=n("lMJ2");e.address=i;const s=n("lin5");e.crypto=s;const o=n("IiU8");e.ECPair=o;const u=n("A6N3");e.networks=u;const a=n("iRDL");e.payments=a;const p=n("O5DG");e.script=p;var c=n("QDNB");e.Block=c.Block;var h=n("Re6D");e.Psbt=h.Psbt;var f=n("O5DG");e.opcodes=f.OPS;var l=n("NPSo");e.Transaction=l.Transaction;var d=n("yRTm");e.TransactionBuilder=d.TransactionBuilder},WkSN:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG");function i(t){const e=r.decompile(t);return 2===e.length&&r.isCanonicalScriptSignature(e[0])&&r.isCanonicalPubKey(e[1])}e.check=i,i.toJSON=()=>"pubKeyHash input"},XKyx:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.prop=function(t,e,n){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){const t=n.call(this);return this[e]=t,t},set(t){Object.defineProperty(this,e,{configurable:!0,enumerable:!0,value:t,writable:!0})}})},e.value=function(t){let e;return()=>void 0!==e?e:e=t()}},YgBC:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("O5DG");function s(t){const e=r.compile(t);return 25===e.length&&e[0]===i.OPS.OP_DUP&&e[1]===i.OPS.OP_HASH160&&20===e[2]&&e[23]===i.OPS.OP_EQUALVERIFY&&e[24]===i.OPS.OP_CHECKSIG}e.check=s,s.toJSON=()=>"pubKeyHash output"},YkUL:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("O5DG");function s(t){return t===i.OPS.OP_0||r.isCanonicalScriptSignature(t)}function o(t,e){const n=r.decompile(t);return!(n.length<2)&&(n[0]===i.OPS.OP_0&&(e?n.slice(1).every(s):n.slice(1).every(r.isCanonicalScriptSignature)))}e.check=o,o.toJSON=()=>"multisig input"},YxaY:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("xmXb"),s=n("bEv/"),o=n("SqU0"),u=n("TJSY"),a=n("cZz8");function p(e,n){const p=r.decompile(e);if(p.length<1)return!1;const c=p[p.length-1];if(!t.isBuffer(c))return!1;const h=r.decompile(r.compile(p.slice(0,-1))),f=r.decompile(c);return!!f&&(!!r.isPushOnly(h)&&(1===p.length?a.check(f)||u.check(f):!(!o.input.check(h)||!o.output.check(f))||(!(!i.input.check(h,n)||!i.output.check(f))||!(!s.input.check(h)||!s.output.check(f)))))}e.check=p,p.toJSON=()=>"scriptHash input"}).call(this,n("HDXh").Buffer)},"bEv/":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("I/fK");e.input=r;const i=n("Nw9z");e.output=i},cZz8:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("O5DG");function s(t){const e=r.compile(t);return 34===e.length&&e[0]===i.OPS.OP_0&&32===e[1]}e.check=s,s.toJSON=()=>"Witness scriptHash output"},dfgu:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.decode=function(t,e,n){e=e||4,n=void 0===n||n;const r=t.length;if(0===r)return 0;if(r>e)throw new TypeError("Script number overflow");if(n&&0==(127&t[r-1])&&(r<=1||0==(128&t[r-2])))throw new Error("Non-minimally encoded script number");if(5===r){const e=t.readUInt32LE(0),n=t.readUInt8(4);return 128&n?-(4294967296*(-129&n)+e):4294967296*n+e}let i=0;for(let e=0;e<r;++e)i|=t[e]<<8*e;return 128&t[r-1]?-(i&~(128<<8*(r-1))):i},e.encode=function(e){let n=Math.abs(e);const r=(i=n)>2147483647?5:i>8388607?4:i>32767?3:i>127?2:i>0?1:0;var i;const s=t.allocUnsafe(r),o=e<0;for(let t=0;t<r;++t)s.writeUInt8(255&n,t),n>>=8;return 128&s[r-1]?s.writeUInt8(o?128:0,r-1):o&&(s[r-1]|=128),s}}).call(this,n("HDXh").Buffer)},iRDL:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("W89i");e.embed=r.p2data;const i=n("Is0A");e.p2ms=i.p2ms;const s=n("vsEA");e.p2pk=s.p2pk;const o=n("rLNA");e.p2pkh=o.p2pkh;const u=n("xLoW");e.p2sh=u.p2sh;const a=n("8GU6");e.p2wpkh=a.p2wpkh;const p=n("lEHy");e.p2wsh=p.p2wsh},lEHy:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("lin5"),i=n("A6N3"),s=n("O5DG"),o=n("XKyx"),u=n("d+zW"),a=s.OPS,p=n("vyt/"),c=t.alloc(0);e.p2wsh=function(e,n){if(!(e.address||e.hash||e.output||e.redeem||e.witness))throw new TypeError("Not enough data");n=Object.assign({validate:!0},n||{}),u({network:u.maybe(u.Object),address:u.maybe(u.String),hash:u.maybe(u.BufferN(32)),output:u.maybe(u.BufferN(34)),redeem:u.maybe({input:u.maybe(u.Buffer),network:u.maybe(u.Object),output:u.maybe(u.Buffer),witness:u.maybe(u.arrayOf(u.Buffer))}),input:u.maybe(u.BufferN(0)),witness:u.maybe(u.arrayOf(u.Buffer))},e);const h=o.value(()=>{const n=p.decode(e.address),r=n.words.shift(),i=p.fromWords(n.words);return{version:r,prefix:n.prefix,data:t.from(i)}}),f=o.value(()=>s.decompile(e.redeem.input));let l=e.network;l||(l=e.redeem&&e.redeem.network||i.bitcoin);const d={network:l};if(o.prop(d,"address",()=>{if(!d.hash)return;const t=p.toWords(d.hash);return t.unshift(0),p.encode(l.bech32,t)}),o.prop(d,"hash",()=>e.output?e.output.slice(2):e.address?h().data:d.redeem&&d.redeem.output?r.sha256(d.redeem.output):void 0),o.prop(d,"output",()=>{if(d.hash)return s.compile([a.OP_0,d.hash])}),o.prop(d,"redeem",()=>{if(e.witness)return{output:e.witness[e.witness.length-1],input:c,witness:e.witness.slice(0,-1)}}),o.prop(d,"input",()=>{if(d.witness)return c}),o.prop(d,"witness",()=>{if(e.redeem&&e.redeem.input&&e.redeem.input.length>0&&e.redeem.output&&e.redeem.output.length>0){const t=s.toStack(f());return d.redeem=Object.assign({witness:t},e.redeem),d.redeem.input=c,[].concat(t,e.redeem.output)}if(e.redeem&&e.redeem.output&&e.redeem.witness)return[].concat(e.redeem.witness,e.redeem.output)}),o.prop(d,"name",()=>{const t=["p2wsh"];return void 0!==d.redeem&&t.push(d.redeem.name),t.join("-")}),n.validate){let n=t.from([]);if(e.address){if(h().prefix!==l.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(0!==h().version)throw new TypeError("Invalid address version");if(32!==h().data.length)throw new TypeError("Invalid address data");n=h().data}if(e.hash){if(n.length>0&&!n.equals(e.hash))throw new TypeError("Hash mismatch");n=e.hash}if(e.output){if(34!==e.output.length||e.output[0]!==a.OP_0||32!==e.output[1])throw new TypeError("Output is invalid");const t=e.output.slice(2);if(n.length>0&&!n.equals(t))throw new TypeError("Hash mismatch");n=t}if(e.redeem){if(e.redeem.network&&e.redeem.network!==l)throw new TypeError("Network mismatch");if(e.redeem.input&&e.redeem.input.length>0&&e.redeem.witness&&e.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(e.redeem.output){if(0===s.decompile(e.redeem.output).length)throw new TypeError("Redeem.output is invalid");const t=r.sha256(e.redeem.output);if(n.length>0&&!n.equals(t))throw new TypeError("Hash mismatch");n=t}if(e.redeem.input&&!s.isPushOnly(f()))throw new TypeError("Non push-only scriptSig");if(e.witness&&e.redeem.witness&&!function(t,e){return t.length===e.length&&t.every((t,n)=>t.equals(e[n]))}(e.witness,e.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch")}if(e.witness&&e.redeem&&e.redeem.output&&!e.redeem.output.equals(e.witness[e.witness.length-1]))throw new TypeError("Witness and redeem.output mismatch")}return Object.assign(d,e)}}).call(this,n("HDXh").Buffer)},lMJ2:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("A6N3"),i=n("iRDL"),s=n("O5DG"),o=n("wmJG"),u=n("vyt/"),a=n("b3gk"),p=n("d+zW");function c(t){const e=a.decode(t);if(e.length<21)throw new TypeError(t+" is too short");if(e.length>21)throw new TypeError(t+" is too long");return{version:e.readUInt8(0),hash:e.slice(1)}}function h(e){const n=u.decode(e),r=u.fromWords(n.words.slice(1));return{version:n.words[0],prefix:n.prefix,data:t.from(r)}}e.fromBase58Check=c,e.fromBech32=h,e.toBase58Check=function(e,n){p(o.tuple(o.Hash160bit,o.UInt8),arguments);const r=t.allocUnsafe(21);return r.writeUInt8(n,0),e.copy(r,1),a.encode(r)},e.toBech32=function(t,e,n){const r=u.toWords(t);return r.unshift(e),u.encode(n,r)},e.fromOutputScript=function(t,e){e=e||r.bitcoin;try{return i.p2pkh({output:t,network:e}).address}catch(t){}try{return i.p2sh({output:t,network:e}).address}catch(t){}try{return i.p2wpkh({output:t,network:e}).address}catch(t){}try{return i.p2wsh({output:t,network:e}).address}catch(t){}throw new Error(s.toASM(t)+" has no matching Address")},e.toOutputScript=function(t,e){let n,s;e=e||r.bitcoin;try{n=c(t)}catch(t){}if(n){if(n.version===e.pubKeyHash)return i.p2pkh({hash:n.hash}).output;if(n.version===e.scriptHash)return i.p2sh({hash:n.hash}).output}else{try{s=h(t)}catch(t){}if(s){if(s.prefix!==e.bech32)throw new Error(t+" has an invalid prefix");if(0===s.version){if(20===s.data.length)return i.p2wpkh({hash:s.data}).output;if(32===s.data.length)return i.p2wsh({hash:s.data}).output}}}throw new Error(t+" has no matching Script")}}).call(this,n("HDXh").Buffer)},lin5:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("mObS");function i(t){try{return r("rmd160").update(t).digest()}catch(e){return r("ripemd160").update(t).digest()}}function s(t){return r("sha256").update(t).digest()}e.ripemd160=i,e.sha1=function(t){return r("sha1").update(t).digest()},e.sha256=s,e.hash160=function(t){return i(s(t))},e.hash256=function(t){return s(s(t))}},mBxT:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("O5DG");function s(t){const e=r.compile(t);return 23===e.length&&e[0]===i.OPS.OP_HASH160&&20===e[1]&&e[22]===i.OPS.OP_EQUAL}e.check=s,s.toJSON=()=>"scriptHash output"},mi50:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG"),i=n("O5DG"),s=n("wmJG"),o=i.OPS.OP_RESERVED;function u(t,e){const n=r.decompile(t);if(n.length<4)return!1;if(n[n.length-1]!==i.OPS.OP_CHECKMULTISIG)return!1;if(!s.Number(n[0]))return!1;if(!s.Number(n[n.length-2]))return!1;const u=n[0]-o,a=n[n.length-2]-o;return!(u<=0)&&(!(a>16)&&(!(u>a)&&(a===n.length-3&&(!!e||n.slice(1,-2).every(r.isCanonicalPubKey)))))}e.check=u,u.toJSON=()=>"multi-sig output"},n8MN:function(t,e,n){"use strict";function r(t,e){if("number"!=typeof t)throw new Error("cannot write a non-number as a number");if(t<0)throw new Error("specified a negative value for writing an unsigned value");if(t>e)throw new Error("RangeError: value out of range");if(Math.floor(t)!==t)throw new Error("value has a fractional component")}Object.defineProperty(e,"__esModule",{value:!0}),e.readUInt64LE=function(t,e){const n=t.readUInt32LE(e);let i=t.readUInt32LE(e+4);return r((i*=4294967296)+n,9007199254740991),i+n},e.writeUInt64LE=function(t,e,n){return r(e,9007199254740991),t.writeInt32LE(-1&e,n),t.writeUInt32LE(Math.floor(e/4294967296),n+4),n+8},e.reverseBuffer=function(t){if(t.length<1)return t;let e=t.length-1,n=0;for(let r=0;r<t.length/2;r++)n=t[r],t[r]=t[e],t[e]=n,e--;return t}},pFpI:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("O5DG");function i(t){const e=r.decompile(t);return 2===e.length&&r.isCanonicalScriptSignature(e[0])&&(n=e[1],r.isCanonicalPubKey(n)&&33===n.length);var n}e.check=i,i.toJSON=()=>"witnessPubKeyHash input"},rLNA:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("lin5"),i=n("A6N3"),s=n("O5DG"),o=n("XKyx"),u=n("d+zW"),a=s.OPS,p=n("KfcP"),c=n("b3gk");e.p2pkh=function(e,n){if(!(e.address||e.hash||e.output||e.pubkey||e.input))throw new TypeError("Not enough data");n=Object.assign({validate:!0},n||{}),u({network:u.maybe(u.Object),address:u.maybe(u.String),hash:u.maybe(u.BufferN(20)),output:u.maybe(u.BufferN(25)),pubkey:u.maybe(p.isPoint),signature:u.maybe(s.isCanonicalScriptSignature),input:u.maybe(u.Buffer)},e);const h=o.value(()=>{const t=c.decode(e.address);return{version:t.readUInt8(0),hash:t.slice(1)}}),f=o.value(()=>s.decompile(e.input)),l=e.network||i.bitcoin,d={name:"p2pkh",network:l};if(o.prop(d,"address",()=>{if(!d.hash)return;const e=t.allocUnsafe(21);return e.writeUInt8(l.pubKeyHash,0),d.hash.copy(e,1),c.encode(e)}),o.prop(d,"hash",()=>e.output?e.output.slice(3,23):e.address?h().hash:e.pubkey||d.pubkey?r.hash160(e.pubkey||d.pubkey):void 0),o.prop(d,"output",()=>{if(d.hash)return s.compile([a.OP_DUP,a.OP_HASH160,d.hash,a.OP_EQUALVERIFY,a.OP_CHECKSIG])}),o.prop(d,"pubkey",()=>{if(e.input)return f()[1]}),o.prop(d,"signature",()=>{if(e.input)return f()[0]}),o.prop(d,"input",()=>{if(e.pubkey&&e.signature)return s.compile([e.signature,e.pubkey])}),o.prop(d,"witness",()=>{if(d.input)return[]}),n.validate){let n=t.from([]);if(e.address){if(h().version!==l.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(20!==h().hash.length)throw new TypeError("Invalid address");n=h().hash}if(e.hash){if(n.length>0&&!n.equals(e.hash))throw new TypeError("Hash mismatch");n=e.hash}if(e.output){if(25!==e.output.length||e.output[0]!==a.OP_DUP||e.output[1]!==a.OP_HASH160||20!==e.output[2]||e.output[23]!==a.OP_EQUALVERIFY||e.output[24]!==a.OP_CHECKSIG)throw new TypeError("Output is invalid");const t=e.output.slice(3,23);if(n.length>0&&!n.equals(t))throw new TypeError("Hash mismatch");n=t}if(e.pubkey){const t=r.hash160(e.pubkey);if(n.length>0&&!n.equals(t))throw new TypeError("Hash mismatch");n=t}if(e.input){const t=f();if(2!==t.length)throw new TypeError("Input is invalid");if(!s.isCanonicalScriptSignature(t[0]))throw new TypeError("Input has invalid signature");if(!p.isPoint(t[1]))throw new TypeError("Input has invalid pubkey");if(e.signature&&!e.signature.equals(t[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(t[1]))throw new TypeError("Pubkey mismatch");const i=r.hash160(t[1]);if(n.length>0&&!n.equals(i))throw new TypeError("Hash mismatch")}}return Object.assign(d,e)}}).call(this,n("HDXh").Buffer)},"vR+u":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("Fh8C");e.input=r;const i=n("cZz8");e.output=i},vsEA:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("A6N3"),i=n("O5DG"),s=n("XKyx"),o=n("d+zW"),u=i.OPS,a=n("KfcP");e.p2pk=function(t,e){if(!(t.input||t.output||t.pubkey||t.input||t.signature))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),o({network:o.maybe(o.Object),output:o.maybe(o.Buffer),pubkey:o.maybe(a.isPoint),signature:o.maybe(i.isCanonicalScriptSignature),input:o.maybe(o.Buffer)},t);const n=s.value(()=>i.decompile(t.input)),p={name:"p2pk",network:t.network||r.bitcoin};if(s.prop(p,"output",()=>{if(t.pubkey)return i.compile([t.pubkey,u.OP_CHECKSIG])}),s.prop(p,"pubkey",()=>{if(t.output)return t.output.slice(1,-1)}),s.prop(p,"signature",()=>{if(t.input)return n()[0]}),s.prop(p,"input",()=>{if(t.signature)return i.compile([t.signature])}),s.prop(p,"witness",()=>{if(p.input)return[]}),e.validate){if(t.output){if(t.output[t.output.length-1]!==u.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!a.isPoint(p.pubkey))throw new TypeError("Output pubkey is invalid");if(t.pubkey&&!t.pubkey.equals(p.pubkey))throw new TypeError("Pubkey mismatch")}if(t.signature&&t.input&&!t.input.equals(p.input))throw new TypeError("Signature mismatch");if(t.input){if(1!==n().length)throw new TypeError("Input is invalid");if(!i.isCanonicalScriptSignature(p.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(p,t)}},wmJG:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("d+zW"),i=Math.pow(2,31)-1;function s(t){return r.String(t)&&!!t.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}e.UInt31=function(t){return r.UInt32(t)&&t<=i},e.BIP32Path=s,s.toJSON=()=>"BIP32 derivation path",e.Signer=function(t){return(r.Buffer(t.publicKey)||"function"==typeof t.getPublicKey)&&"function"==typeof t.sign};const o=21e14;e.Satoshi=function(t){return r.UInt53(t)&&t<=o},e.ECPoint=r.quacksLike("Point"),e.Network=r.compile({messagePrefix:r.oneOf(r.Buffer,r.String),bip32:{public:r.UInt32,private:r.UInt32},pubKeyHash:r.UInt8,scriptHash:r.UInt8,wif:r.UInt8}),e.Buffer256bit=r.BufferN(32),e.Hash160bit=r.BufferN(20),e.Hash256bit=r.BufferN(32),e.Number=r.Number,e.Array=r.Array,e.Boolean=r.Boolean,e.String=r.String,e.Buffer=r.Buffer,e.Hex=r.Hex,e.maybe=r.maybe,e.tuple=r.tuple,e.UInt8=r.UInt8,e.UInt32=r.UInt32,e.Function=r.Function,e.BufferN=r.BufferN,e.Null=r.Null,e.oneOf=r.oneOf},xLoW:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("lin5"),i=n("A6N3"),s=n("O5DG"),o=n("XKyx"),u=n("d+zW"),a=s.OPS,p=n("b3gk");e.p2sh=function(e,n){if(!(e.address||e.hash||e.output||e.redeem||e.input))throw new TypeError("Not enough data");n=Object.assign({validate:!0},n||{}),u({network:u.maybe(u.Object),address:u.maybe(u.String),hash:u.maybe(u.BufferN(20)),output:u.maybe(u.BufferN(23)),redeem:u.maybe({network:u.maybe(u.Object),output:u.maybe(u.Buffer),input:u.maybe(u.Buffer),witness:u.maybe(u.arrayOf(u.Buffer))}),input:u.maybe(u.Buffer),witness:u.maybe(u.arrayOf(u.Buffer))},e);let c=e.network;c||(c=e.redeem&&e.redeem.network||i.bitcoin);const h={network:c},f=o.value(()=>{const t=p.decode(e.address);return{version:t.readUInt8(0),hash:t.slice(1)}}),l=o.value(()=>s.decompile(e.input)),d=o.value(()=>{const t=l();return{network:c,output:t[t.length-1],input:s.compile(t.slice(0,-1)),witness:e.witness||[]}});if(o.prop(h,"address",()=>{if(!h.hash)return;const e=t.allocUnsafe(21);return e.writeUInt8(h.network.scriptHash,0),h.hash.copy(e,1),p.encode(e)}),o.prop(h,"hash",()=>e.output?e.output.slice(2,22):e.address?f().hash:h.redeem&&h.redeem.output?r.hash160(h.redeem.output):void 0),o.prop(h,"output",()=>{if(h.hash)return s.compile([a.OP_HASH160,h.hash,a.OP_EQUAL])}),o.prop(h,"redeem",()=>{if(e.input)return d()}),o.prop(h,"input",()=>{if(e.redeem&&e.redeem.input&&e.redeem.output)return s.compile([].concat(s.decompile(e.redeem.input),e.redeem.output))}),o.prop(h,"witness",()=>h.redeem&&h.redeem.witness?h.redeem.witness:h.input?[]:void 0),o.prop(h,"name",()=>{const t=["p2sh"];return void 0!==h.redeem&&t.push(h.redeem.name),t.join("-")}),n.validate){let n=t.from([]);if(e.address){if(f().version!==c.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(20!==f().hash.length)throw new TypeError("Invalid address");n=f().hash}if(e.hash){if(n.length>0&&!n.equals(e.hash))throw new TypeError("Hash mismatch");n=e.hash}if(e.output){if(23!==e.output.length||e.output[0]!==a.OP_HASH160||20!==e.output[1]||e.output[22]!==a.OP_EQUAL)throw new TypeError("Output is invalid");const t=e.output.slice(2,22);if(n.length>0&&!n.equals(t))throw new TypeError("Hash mismatch");n=t}const i=t=>{if(t.output){const e=s.decompile(t.output);if(!e||e.length<1)throw new TypeError("Redeem.output too short");const i=r.hash160(t.output);if(n.length>0&&!n.equals(i))throw new TypeError("Hash mismatch");n=i}if(t.input){const e=t.input.length>0,n=t.witness&&t.witness.length>0;if(!e&&!n)throw new TypeError("Empty input");if(e&&n)throw new TypeError("Input and witness provided");if(e){const e=s.decompile(t.input);if(!s.isPushOnly(e))throw new TypeError("Non push-only scriptSig")}}};if(e.input){const e=l();if(!e||e.length<1)throw new TypeError("Input too short");if(!t.isBuffer(d().output))throw new TypeError("Input is invalid");i(d())}if(e.redeem){if(e.redeem.network&&e.redeem.network!==c)throw new TypeError("Network mismatch");if(e.input){const t=d();if(e.redeem.output&&!e.redeem.output.equals(t.output))throw new TypeError("Redeem.output mismatch");if(e.redeem.input&&!e.redeem.input.equals(t.input))throw new TypeError("Redeem.input mismatch")}i(e.redeem)}if(e.witness&&e.redeem&&e.redeem.witness&&!function(t,e){return t.length===e.length&&t.every((t,n)=>t.equals(e[n]))}(e.redeem.witness,e.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(h,e)}}).call(this,n("HDXh").Buffer)},xmXb:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("YkUL");e.input=r;const i=n("mi50");e.output=i},yRTm:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});const r=n("lMJ2"),i=n("n8MN"),s=n("I6F5"),o=n("lin5"),u=n("IiU8"),a=n("A6N3"),p=n("iRDL"),c=n("O5DG"),h=n("O5DG"),f=n("NPSo"),l=n("wmJG"),d=n("d+zW"),w=s.types,m=new Set(["p2pkh","p2pk","p2wpkh","p2ms","p2sh-p2pkh","p2sh-p2pk","p2sh-p2wpkh","p2sh-p2ms","p2wsh-p2pkh","p2wsh-p2pk","p2wsh-p2ms","p2sh-p2wsh-p2pkh","p2sh-p2wsh-p2pk","p2sh-p2wsh-p2ms"]);function y(t,e,n){try{d(t,e)}catch(t){throw new Error(n)}}class _{constructor(t=a.bitcoin,e=2500){this.network=t,this.maximumFeeRate=e,this.__PREV_TX_SET={},this.__INPUTS=[],this.__TX=new f.Transaction,this.__TX.version=2,this.__USE_LOW_R=!1,console.warn("Deprecation Warning: TransactionBuilder will be removed in the future. (v6.x.x or later) Please use the Psbt class instead. Examples of usage are available in the transactions-psbt.js integration test file on our Github. A high level explanation is available in the psbt.ts and psbt.js files as well.")}static fromTransaction(t,e){const n=new _(e);return n.setVersion(t.version),n.setLockTime(t.locktime),t.outs.forEach(t=>{n.addOutput(t.script,t.value)}),t.ins.forEach(t=>{n.__addInputUnsafe(t.hash,t.index,{sequence:t.sequence,script:t.script,witness:t.witness})}),n.__INPUTS.forEach((e,n)=>{!function(t,e,n){if(t.redeemScriptType!==w.P2MS||!t.redeemScript)return;if(t.pubkeys.length===t.signatures.length)return;const r=t.signatures.concat();t.signatures=t.pubkeys.map(i=>{const s=u.fromPublicKey(i);let o;return r.some((i,u)=>{if(!i)return!1;const a=c.signature.decode(i),p=e.hashForSignature(n,t.redeemScript,a.hashType);return!!s.verify(p,a.signature)&&(r[u]=void 0,o=i,!0)}),o})}(e,t,n)}),n}setLowR(t){return d(d.maybe(d.Boolean),t),void 0===t&&(t=!0),this.__USE_LOW_R=t,t}setLockTime(t){if(d(l.UInt32,t),this.__INPUTS.some(t=>!!t.signatures&&t.signatures.some(t=>void 0!==t)))throw new Error("No, this would invalidate signatures");this.__TX.locktime=t}setVersion(t){d(l.UInt32,t),this.__TX.version=t}addInput(e,n,r,s){if(!this.__canModifyInputs())throw new Error("No, this would invalidate signatures");let o;if("string"==typeof(u=e)||u instanceof String)e=i.reverseBuffer(t.from(e,"hex"));else if(function(t){return t instanceof f.Transaction}(e)){const t=e.outs[n];s=t.script,o=t.value,e=e.getHash(!1)}var u;return this.__addInputUnsafe(e,n,{sequence:r,prevOutScript:s,value:o})}addOutput(t,e){if(!this.__canModifyOutputs())throw new Error("No, this would invalidate signatures");return"string"==typeof t&&(t=r.toOutputScript(t,this.network)),this.__TX.addOutput(t,e)}build(){return this.__build(!1)}buildIncomplete(){return this.__build(!0)}sign(t,e,n,r,i,s){!function({input:t,ourPubKey:e,keyPair:n,signatureHash:r,hashType:i,useLowR:s}){let o=!1;for(const[u,a]of t.pubkeys.entries()){if(!e.equals(a))continue;if(t.signatures[u])throw new Error("Signature already exists");if(33!==e.length&&t.hasWitness)throw new Error("BIP143 rejects uncompressed public keys in P2WPKH or P2WSH");const p=n.sign(r,s);t.signatures[u]=c.signature.encode(p,i),o=!0}if(!o)throw new Error("Key pair cannot sign for this input")}(function(t,e,n,r,i,s,o,u,a,h,_){let O;if("number"==typeof i)console.warn("DEPRECATED: TransactionBuilder sign method arguments will change in v6, please use the TxbSignArg interface"),O=i;else{if("object"!=typeof i)throw new TypeError("TransactionBuilder sign first arg must be TxbSignArg or number");!function(t,e){if(!m.has(e.prevOutScriptType))throw new TypeError(`Unknown prevOutScriptType "${e.prevOutScriptType}"`);y(d.Number,e.vin,"sign must include vin parameter as Number (input index)"),y(l.Signer,e.keyPair,"sign must include keyPair parameter as Signer interface"),y(d.maybe(d.Number),e.hashType,"sign hashType parameter must be a number");const n=(t[e.vin]||[]).prevOutType,r=e.prevOutScriptType;switch(r){case"p2pkh":if(n&&"pubkeyhash"!==n)throw new TypeError(`input #${e.vin} is not of type p2pkh: ${n}`);y(d.value(void 0),e.witnessScript,`${r} requires NO witnessScript`),y(d.value(void 0),e.redeemScript,`${r} requires NO redeemScript`),y(d.value(void 0),e.witnessValue,`${r} requires NO witnessValue`);break;case"p2pk":if(n&&"pubkey"!==n)throw new TypeError(`input #${e.vin} is not of type p2pk: ${n}`);y(d.value(void 0),e.witnessScript,`${r} requires NO witnessScript`),y(d.value(void 0),e.redeemScript,`${r} requires NO redeemScript`),y(d.value(void 0),e.witnessValue,`${r} requires NO witnessValue`);break;case"p2wpkh":if(n&&"witnesspubkeyhash"!==n)throw new TypeError(`input #${e.vin} is not of type p2wpkh: ${n}`);y(d.value(void 0),e.witnessScript,`${r} requires NO witnessScript`),y(d.value(void 0),e.redeemScript,`${r} requires NO redeemScript`),y(l.Satoshi,e.witnessValue,`${r} requires witnessValue`);break;case"p2ms":if(n&&"multisig"!==n)throw new TypeError(`input #${e.vin} is not of type p2ms: ${n}`);y(d.value(void 0),e.witnessScript,`${r} requires NO witnessScript`),y(d.value(void 0),e.redeemScript,`${r} requires NO redeemScript`),y(d.value(void 0),e.witnessValue,`${r} requires NO witnessValue`);break;case"p2sh-p2wpkh":if(n&&"scripthash"!==n)throw new TypeError(`input #${e.vin} is not of type p2sh-p2wpkh: ${n}`);y(d.value(void 0),e.witnessScript,`${r} requires NO witnessScript`),y(d.Buffer,e.redeemScript,`${r} requires redeemScript`),y(l.Satoshi,e.witnessValue,`${r} requires witnessValue`);break;case"p2sh-p2ms":case"p2sh-p2pk":case"p2sh-p2pkh":if(n&&"scripthash"!==n)throw new TypeError(`input #${e.vin} is not of type ${r}: ${n}`);y(d.value(void 0),e.witnessScript,`${r} requires NO witnessScript`),y(d.Buffer,e.redeemScript,`${r} requires redeemScript`),y(d.value(void 0),e.witnessValue,`${r} requires NO witnessValue`);break;case"p2wsh-p2ms":case"p2wsh-p2pk":case"p2wsh-p2pkh":if(n&&"witnessscripthash"!==n)throw new TypeError(`input #${e.vin} is not of type ${r}: ${n}`);y(d.Buffer,e.witnessScript,`${r} requires witnessScript`),y(d.value(void 0),e.redeemScript,`${r} requires NO redeemScript`),y(l.Satoshi,e.witnessValue,`${r} requires witnessValue`);break;case"p2sh-p2wsh-p2ms":case"p2sh-p2wsh-p2pk":case"p2sh-p2wsh-p2pkh":if(n&&"scripthash"!==n)throw new TypeError(`input #${e.vin} is not of type ${r}: ${n}`);y(d.Buffer,e.witnessScript,`${r} requires witnessScript`),y(d.Buffer,e.redeemScript,`${r} requires witnessScript`),y(l.Satoshi,e.witnessValue,`${r} requires witnessScript`)}}(e,i),({vin:O,keyPair:s,redeemScript:o,hashType:u,witnessValue:a,witnessScript:h}=i)}if(void 0===s)throw new Error("sign requires keypair");if(s.network&&s.network!==t)throw new TypeError("Inconsistent network");if(!e[O])throw new Error("No input at index: "+O);if(u=u||f.Transaction.SIGHASH_ALL,n(u))throw new Error("Transaction needs outputs");const E=e[O];if(void 0!==E.redeemScript&&o&&!E.redeemScript.equals(o))throw new Error("Inconsistent redeemScript");const b=s.publicKey||s.getPublicKey&&s.getPublicKey();if(!S(E)){if(void 0!==a){if(void 0!==E.value&&E.value!==a)throw new Error("Input did not match witnessValue");d(l.Satoshi,a),E.value=a}if(!S(E)){const t=function(t,e,n,r){if(n&&r){const i=p.p2wsh({redeem:{output:r}}),s=p.p2wsh({output:n}),o=p.p2sh({redeem:{output:n}}),u=p.p2sh({redeem:i});if(!i.hash.equals(s.hash))throw new Error("Witness script inconsistent with prevOutScript");if(!o.hash.equals(u.hash))throw new Error("Redeem script inconsistent with prevOutScript");const a=g(i.redeem.output,e);if(!a.pubkeys)throw new Error(a.type+" not supported as witnessScript ("+c.toASM(r)+")");t.signatures&&t.signatures.some(t=>void 0!==t)&&(a.signatures=t.signatures);const h=r;if(a.type===w.P2WPKH)throw new Error("P2SH(P2WSH(P2WPKH)) is a consensus failure");return{redeemScript:n,redeemScriptType:w.P2WSH,witnessScript:r,witnessScriptType:a.type,prevOutType:w.P2SH,prevOutScript:o.output,hasWitness:!0,signScript:h,signType:a.type,pubkeys:a.pubkeys,signatures:a.signatures,maxSignatures:a.maxSignatures}}if(n){const r=p.p2sh({redeem:{output:n}});if(t.prevOutScript){let e;try{e=p.p2sh({output:t.prevOutScript})}catch(t){throw new Error("PrevOutScript must be P2SH")}if(!r.hash.equals(e.hash))throw new Error("Redeem script inconsistent with prevOutScript")}const i=g(r.redeem.output,e);if(!i.pubkeys)throw new Error(i.type+" not supported as redeemScript ("+c.toASM(n)+")");t.signatures&&t.signatures.some(t=>void 0!==t)&&(i.signatures=t.signatures);let s=n;return i.type===w.P2WPKH&&(s=p.p2pkh({pubkey:i.pubkeys[0]}).output),{redeemScript:n,redeemScriptType:i.type,prevOutType:w.P2SH,prevOutScript:r.output,hasWitness:i.type===w.P2WPKH,signScript:s,signType:i.type,pubkeys:i.pubkeys,signatures:i.signatures,maxSignatures:i.maxSignatures}}if(r){const n=p.p2wsh({redeem:{output:r}});if(t.prevOutScript){const e=p.p2wsh({output:t.prevOutScript});if(!n.hash.equals(e.hash))throw new Error("Witness script inconsistent with prevOutScript")}const i=g(n.redeem.output,e);if(!i.pubkeys)throw new Error(i.type+" not supported as witnessScript ("+c.toASM(r)+")");t.signatures&&t.signatures.some(t=>void 0!==t)&&(i.signatures=t.signatures);const s=r;if(i.type===w.P2WPKH)throw new Error("P2WSH(P2WPKH) is a consensus failure");return{witnessScript:r,witnessScriptType:i.type,prevOutType:w.P2WSH,prevOutScript:n.output,hasWitness:!0,signScript:s,signType:i.type,pubkeys:i.pubkeys,signatures:i.signatures,maxSignatures:i.maxSignatures}}if(t.prevOutType&&t.prevOutScript){if(t.prevOutType===w.P2SH)throw new Error("PrevOutScript is "+t.prevOutType+", requires redeemScript");if(t.prevOutType===w.P2WSH)throw new Error("PrevOutScript is "+t.prevOutType+", requires witnessScript");if(!t.prevOutScript)throw new Error("PrevOutScript is missing");const n=g(t.prevOutScript,e);if(!n.pubkeys)throw new Error(n.type+" not supported ("+c.toASM(t.prevOutScript)+")");t.signatures&&t.signatures.some(t=>void 0!==t)&&(n.signatures=t.signatures);let r=t.prevOutScript;return n.type===w.P2WPKH&&(r=p.p2pkh({pubkey:n.pubkeys[0]}).output),{prevOutType:n.type,prevOutScript:t.prevOutScript,hasWitness:n.type===w.P2WPKH,signScript:r,signType:n.type,pubkeys:n.pubkeys,signatures:n.signatures,maxSignatures:n.maxSignatures}}const i=p.p2pkh({pubkey:e}).output;return{prevOutType:w.P2PKH,prevOutScript:i,hasWitness:!1,signScript:i,signType:w.P2PKH,pubkeys:[e],signatures:[void 0]}}(E,b,o,h);Object.assign(E,t)}if(!S(E))throw Error(E.prevOutType+" not supported")}let P;P=E.hasWitness?r.hashForWitnessV0(O,E.signScript,E.value,u):r.hashForSignature(O,E.signScript,u);return{input:E,ourPubKey:b,keyPair:s,signatureHash:P,hashType:u,useLowR:!!_}}(this.network,this.__INPUTS,this.__needsOutputs.bind(this),this.__TX,t,e,n,r,i,s,this.__USE_LOW_R))}__addInputUnsafe(t,e,n){if(f.Transaction.isCoinbaseHash(t))throw new Error("coinbase inputs not supported");const r=t.toString("hex")+":"+e;if(void 0!==this.__PREV_TX_SET[r])throw new Error("Duplicate TxOut: "+r);let i={};if(void 0!==n.script&&(i=function t(e,n,r,i){if(0===e.length&&0===n.length)return{};if(!r){let t=s.input(e,!0),i=s.witness(n,!0);t===w.NONSTANDARD&&(t=void 0),i===w.NONSTANDARD&&(i=void 0),r=t||i}switch(r){case w.P2WPKH:{const{output:t,pubkey:e,signature:r}=p.p2wpkh({witness:n});return{prevOutScript:t,prevOutType:w.P2WPKH,pubkeys:[e],signatures:[r]}}case w.P2PKH:{const{output:t,pubkey:n,signature:r}=p.p2pkh({input:e});return{prevOutScript:t,prevOutType:w.P2PKH,pubkeys:[n],signatures:[r]}}case w.P2PK:{const{signature:t}=p.p2pk({input:e});return{prevOutType:w.P2PK,pubkeys:[void 0],signatures:[t]}}case w.P2MS:{const{m:t,pubkeys:n,signatures:r}=p.p2ms({input:e,output:i},{allowIncomplete:!0});return{prevOutType:w.P2MS,pubkeys:n,signatures:r,maxSignatures:t}}}if(r===w.P2SH){const{output:r,redeem:i}=p.p2sh({input:e,witness:n}),o=s.output(i.output),u=t(i.input,i.witness,o,i.output);return u.prevOutType?{prevOutScript:r,prevOutType:w.P2SH,redeemScript:i.output,redeemScriptType:u.prevOutType,witnessScript:u.witnessScript,witnessScriptType:u.witnessScriptType,pubkeys:u.pubkeys,signatures:u.signatures}:{}}if(r===w.P2WSH){const{output:r,redeem:i}=p.p2wsh({input:e,witness:n}),o=s.output(i.output);let u;return(u=o===w.P2WPKH?t(i.input,i.witness,o):t(c.compile(i.witness),[],o,i.output)).prevOutType?{prevOutScript:r,prevOutType:w.P2WSH,witnessScript:i.output,witnessScriptType:u.prevOutType,pubkeys:u.pubkeys,signatures:u.signatures}:{}}return{prevOutType:w.NONSTANDARD,prevOutScript:e}}(n.script,n.witness||[])),void 0!==n.value&&(i.value=n.value),!i.prevOutScript&&n.prevOutScript){let t;if(!i.pubkeys&&!i.signatures){const e=g(n.prevOutScript);e.pubkeys&&(i.pubkeys=e.pubkeys,i.signatures=e.signatures),t=e.type}i.prevOutScript=n.prevOutScript,i.prevOutType=t||s.output(n.prevOutScript)}const o=this.__TX.addInput(t,e,n.sequence,n.scriptSig);return this.__INPUTS[o]=i,this.__PREV_TX_SET[r]=!0,o}__build(t){if(!t){if(!this.__TX.ins.length)throw new Error("Transaction has no inputs");if(!this.__TX.outs.length)throw new Error("Transaction has no outputs")}const e=this.__TX.clone();if(this.__INPUTS.forEach((n,r)=>{if(!n.prevOutType&&!t)throw new Error("Transaction is not complete");const i=function t(e,n,r){const i=n.pubkeys||[];let s=n.signatures||[];switch(e){case w.P2PKH:if(0===i.length)break;if(0===s.length)break;return p.p2pkh({pubkey:i[0],signature:s[0]});case w.P2WPKH:if(0===i.length)break;if(0===s.length)break;return p.p2wpkh({pubkey:i[0],signature:s[0]});case w.P2PK:if(0===i.length)break;if(0===s.length)break;return p.p2pk({signature:s[0]});case w.P2MS:{const t=n.maxSignatures;s=r?s.map(t=>t||h.OPS.OP_0):s.filter(t=>t);const e=!r||t===s.length;return p.p2ms({m:t,pubkeys:i,signatures:s},{allowIncomplete:r,validate:e})}case w.P2SH:{const e=t(n.redeemScriptType,n,r);if(!e)return;return p.p2sh({redeem:{output:e.output||n.redeemScript,input:e.input,witness:e.witness}})}case w.P2WSH:{const e=t(n.witnessScriptType,n,r);if(!e)return;return p.p2wsh({redeem:{output:n.witnessScript,input:e.input,witness:e.witness}})}}}(n.prevOutType,n,t);if(i)e.setInputScript(r,i.input),e.setWitness(r,i.witness);else{if(!t&&n.prevOutType===w.NONSTANDARD)throw new Error("Unknown input type");if(!t)throw new Error("Not enough information")}}),!t&&this.__overMaximumFees(e.virtualSize()))throw new Error("Transaction has absurd fees");return e}__canModifyInputs(){return this.__INPUTS.every(t=>!t.signatures||t.signatures.every(t=>{if(!t)return!0;return 0!=(O(t)&f.Transaction.SIGHASH_ANYONECANPAY)}))}__needsOutputs(t){return t===f.Transaction.SIGHASH_ALL?0===this.__TX.outs.length:0===this.__TX.outs.length&&this.__INPUTS.some(t=>!!t.signatures&&t.signatures.some(t=>{if(!t)return!1;return!(O(t)&f.Transaction.SIGHASH_NONE)}))}__canModifyOutputs(){const t=this.__TX.ins.length,e=this.__TX.outs.length;return this.__INPUTS.every(n=>void 0===n.signatures||n.signatures.every(n=>{if(!n)return!0;const r=31&O(n);return r===f.Transaction.SIGHASH_NONE||r===f.Transaction.SIGHASH_SINGLE&&t<=e}))}__overMaximumFees(t){return(this.__INPUTS.reduce((t,e)=>t+(e.value>>>0),0)-this.__TX.outs.reduce((t,e)=>t+e.value,0))/t>this.maximumFeeRate}}function g(t,e){d(l.Buffer,t);const n=s.output(t);switch(n){case w.P2PKH:{if(!e)return{type:n};const r=p.p2pkh({output:t}).hash,i=o.hash160(e);return r.equals(i)?{type:n,pubkeys:[e],signatures:[void 0]}:{type:n}}case w.P2WPKH:{if(!e)return{type:n};const r=p.p2wpkh({output:t}).hash,i=o.hash160(e);return r.equals(i)?{type:n,pubkeys:[e],signatures:[void 0]}:{type:n}}case w.P2PK:return{type:n,pubkeys:[p.p2pk({output:t}).pubkey],signatures:[void 0]};case w.P2MS:{const e=p.p2ms({output:t});return{type:n,pubkeys:e.pubkeys,signatures:e.pubkeys.map(()=>void 0),maxSignatures:e.m}}}return{type:n}}function S(t){return void 0!==t.signScript&&void 0!==t.signType&&void 0!==t.pubkeys&&void 0!==t.signatures&&t.signatures.length===t.pubkeys.length&&t.pubkeys.length>0&&(!1===t.hasWitness||void 0!==t.value)}function O(t){return t.readUInt8(t.length-1)}e.TransactionBuilder=_}).call(this,n("HDXh").Buffer)},yX9u:function(t,e,n){var r=n("E0BK"),i={};for(var s in r){i[r[s]]=s}t.exports=i}}]);