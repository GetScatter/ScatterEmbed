(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{"5jfV":function(t,e,s){"use strict";var i=s("Vbfb");s.n(i).a},LHAq:function(t,e,s){"use strict";s.r(e);var i=s("L2JU"),a=s("IfgB"),n=s("Gbp+"),o=s("KLk5"),c=s.n(o),r=s("TmN8"),l=s.n(r),u=s("GwxU"),h=s.n(u),d=s("l31u"),p=s.n(d),m=s("ONSl"),g=s.n(m),k=s("qjwK"),f=s("M1Dr"),v=s.n(f),_=s("GGPC"),b=s.n(_),C=s("AZxv");s("8olR");var w={components:{TokenSymbol:C.a},data:()=>({account:null,recipient:null,memo:"",token:null,toSend:null,fiat:0,sending:!1,rawPairs:[],pairs:[],pair:null,rate:null,loadingPairs:!1,loadingRate:!1}),computed:{...Object(i.d)(["history"]),...Object(i.c)(["accounts","displayCurrency"]),sendableTokens(){return this.account.tokens().filter(t=>!t.unusable).sort((t,e)=>h.a.sorter(t,e))},canExchange(){return!!this.rate&&!!this.pair&&!this.sending&&this.recipient&&this.toSend.amount>0&&(null===this.rate.min||this.rate.min<=this.estimatedAmount)&&(null===this.rate.max||this.rate.max>=this.estimatedAmount)},estimatedAmount(){return this.rate&&this.pair?parseFloat(this.rate.rate*this.toSend.amount).toFixed(this.pair.decimals):0},rawPair(){if(this.pair)return this.rawPairs.find(t=>t.token.id===this.pair.id)}},mounted(){const t=this.$route.query.history?this.history.find(t=>t.id===this.$route.query.history):null;if(t)setTimeout(async()=>{if(this.account=t.from,this.recipient=t.to,this.setToken(t.fromToken),await this.getPairs(),this.rawPairs.length){const e=this.rawPairs.find(e=>e.token.uniqueWithChain()===t.toToken.uniqueWithChain());e&&this.setPair(e.token)}});else{if(this.$route.query.account&&(this.account=this.accounts.find(t=>t.identifiable()===this.$route.query.account),this.$route.query.token)){const t=this.account.tokens().find(t=>t.uniqueWithChain()===this.$route.query.token);return this.setToken(t),void(this.recipient=this.account.sendable())}this.account||(this.account=this.accounts.filter(t=>t.tokens().length).sort((t,e)=>e.totalFiatBalance()-t.totalFiatBalance())[0]),this.recipient=this.account.sendable(),this.setToken(this.sendableTokens[0])}},methods:{selectTokenAndAccount(){a.a.push(n.a.selectTokenAndAccount(t=>{if(!t)return;const{token:e,account:s}=t;this.account=s,this.setToken(e),this.recipient=this.account.sendable()}))},selectRecipient(){a.a.push(n.a.selectRecipient(this.account?this.account.blockchain():null,t=>{t&&(this.recipient=t)}))},selectToken(){this.pairs.length&&a.a.push(n.a.selectToken(this.pairs,t=>{t&&this.setPair(t.clone())}))},setToken(t){l.a.setPrices(),this.token=this.account.tokens().find(e=>e.uniqueWithChain()===t.uniqueWithChain()).clone(),this.toSend=this.token.clone(),this.toSend.amount=0,this.fiat=0,this.rate=null,this.pair=null},changedFiat(){this.toSend.amount=parseFloat(this.fiat/this.toSend.fiatPrice(!1)).toFixed(this.toSend.decimals)},changedAmount(){this.fiat=this.toSend.amount&&""!==this.toSend.amount?this.toSend.fiatBalance(!1):null},cantConnect(){a.a.push(n.a.prompt(this.$t("exchange.errorTitle"),this.$t("exchange.errorDescription"))),this.$router.push({name:this.RouteNames.HOME})},setPair(t){this.pair=t,this.getRate()},async getPairs(){this.pair=null,this.pairs={},this.loadingPairs=!0;let t=await p.a.pairs(this.token),{base:e,stable:s,eth:i,eos:a,trx:n}=t;if(this.rawPairs=Object.keys(t).reduce((e,s)=>e=e.concat(t[s]),[]),t){let t=[],o=[];e&&(o=o.concat(e.map(t=>t.token))),s&&(o=o.concat(s.map(t=>t.token))),o.length&&t.push({tokens:o});const c=[i,a,n].filter(t=>!!t).reduce((t,e)=>(e.map(e=>t.push(e.token)),t),[]);c.length&&t.push({tokens:c}),this.pairs=t}else this.cantConnect();return this.rawPairs.length||(this.rate=null),1===this.rawPairs.length&&this.setPair(this.rawPairs[0].token),this.loadingPairs=!1,!0},async getRate(){this.loadingRate=!0,this.rate=null,this.rate=await p.a.rate(this.token,this.rawPair.symbol,this.rawPair.service),this.loadingRate=!1},async exchange(){if(!this.canExchange)return;const t=()=>{this.sending=!1,this.setWorkingScreen(!1)};this.sending=!0,this.setWorkingScreen(!0);const e={account:this.account.sendable()},s={account:this.recipient},i=this.toSend.amount,o=await p.a.order(this.rawPair.service,this.token,this.pair.symbol,i,e,s);if(!o)return this.cantConnect(),t();if("string"==typeof o)return a.a.push(n.a.snackbar(o)),t();this.token.symbol,this.pair.symbol;p.a.accepted(o.id);const r=await v.a[this.account.blockchain()]({account:this.account,recipient:o.account,amount:i,memo:o.memo,token:this.token,promptForSignature:!1,bypassHistory:!0}).catch(t=>(console.error("Exchange error: ",t),!1));if(r)if("object"==typeof r&&r.hasOwnProperty("error"))a.a.push(n.a.snackbar(r.error));else{a.a.push(n.a.transactionSuccess(this.token.blockchain,v.a.getTransferId(r,this.token.blockchain))),g.a.hasToken(this.rawPair.token)||this.rawPair.token.contract&&this.rawPair.token.contract.length&&await g.a.addToken(this.rawPair.token,!1,!1);const t=new b.a(this.account,this.recipient,this.toSend,this.pair,o,v.a.getTransferId(r,this.token.blockchain));this[k.DELTA_HISTORY](t),setTimeout(()=>{p.a.watch(t),c.a.loadBalancesFor(this.account)},1e3)}t()},...Object(i.b)([k.DELTA_HISTORY])},watch:{"token.symbol"(){this.getPairs()}}},y=(s("5jfV"),s("KHd+")),x=Object(y.a)(w,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",[t.account&&t.token&&t.toSend?s("section",{staticClass:"exchange"},[s("section",{staticClass:"scroller"},[s("section",{staticClass:"greyback"},[s("section",{staticClass:"limit-width"},[s("section",{staticClass:"boxes"},[s("section",{staticClass:"box-container"},[s("label",[t._v(t._s(t.$t("exchange.fromAndToken")))]),t._v(" "),s("section",{staticClass:"box nested account-selector flex",on:{click:t.selectTokenAndAccount}},[s("section",{staticClass:"symbol"},[s("TokenSymbol",{attrs:{token:t.token}})],1),t._v(" "),s("section",[s("figure",{staticClass:"name"},[t._v(t._s(t.account.sendable()))]),t._v(" "),s("figure",{staticClass:"network"},[t._v(t._s(t.account.network().name))]),t._v(" "),s("figure",{staticClass:"token"},[t._v(t._s(t.token.amount)+" "+t._s(t.token.symbol))]),t._v(" "),s("figure",{staticClass:"price"},[t._v(t._s(t.token.fiatPrice()))])]),t._v(" "),s("figure",{staticClass:"chevron fas fa-caret-square-down"})])]),t._v(" "),s("section",{staticClass:"box-container"},[s("label",[t._v("Receiver")]),t._v(" "),s("section",{staticClass:"box nested"},[s("section",{staticClass:"padded recipient-selector",on:{click:t.selectRecipient}},[s("figure",{staticClass:"name"},[t._v(t._s(t.$t("generic.contacts")))]),t._v(" "),s("figure",{staticClass:"chevron fas fa-caret-square-down"})]),t._v(" "),s("figure",{staticClass:"line"}),t._v(" "),s("section",{staticClass:"input-container"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.recipient,expression:"recipient"}],staticClass:"input",attrs:{placeholder:t.$t("generic.addressOrAccount")},domProps:{value:t.recipient},on:{input:function(e){e.target.composing||(t.recipient=e.target.value)}}})])])])])])]),t._v(" "),s("section",{staticClass:"whiteback"},[s("section",{staticClass:"limit-width"},[s("section",{staticClass:"boxes",staticStyle:{margin:"0"}},[s("section",{staticClass:"box",class:{"not-allowed":!t.rate}},[s("section",{staticClass:"input-container"},[s("figure",{staticClass:"label"},[t._v(t._s(t.token.truncatedSymbol()))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.toSend.amount,expression:"toSend.amount"}],staticClass:"input",attrs:{disabled:!t.rate,placeholder:"0.00"},domProps:{value:t.toSend.amount},on:{input:[function(e){e.target.composing||t.$set(t.toSend,"amount",e.target.value)},t.changedAmount]}}),t._v(" "),s("section",{staticClass:"amount-helpers"},[s("Button",{attrs:{small:"1",text:"50%"},nativeOn:{click:function(e){return t.toSend.amount=t.token.amount/2,void t.changedAmount()}}}),t._v(" "),s("Button",{attrs:{small:"1",text:"100%"},nativeOn:{click:function(e){return t.toSend.amount=t.token.amount,void t.changedAmount()}}})],1)]),t._v(" "),s("figure",{staticClass:"line"}),t._v(" "),s("section",{staticClass:"input-container"},[s("figure",{staticClass:"label"},[t._v(t._s(t.displayCurrency))]),t._v(" "),t.toSend.fiatPrice()?s("input",{directives:[{name:"model",rawName:"v-model",value:t.fiat,expression:"fiat"}],staticClass:"input",attrs:{disabled:!t.rate,placeholder:"0.00"},domProps:{value:t.fiat},on:{input:[function(e){e.target.composing||(t.fiat=e.target.value)},t.changedFiat]}}):s("figure",{staticClass:"input not-available"},[t._v(t._s(t.$t("exchange.priceNotAvailable")))])])]),t._v(" "),t.loadingPairs?s("section",{staticClass:"box account-selector"},[t._m(0),t._v(" "),s("section",[s("figure",{staticClass:"name"},[t._v(t._s(t.$t("exchange.loadingPairs")))]),t._v(" "),s("figure",{staticClass:"network"},[t._v(t._s(t.$t("generic.pleaseWait")))])])]):t._e(),t._v(" "),t.loadingPairs?t._e():s("section",{staticClass:"box account-selector",on:{click:t.selectToken}},[t.pair?t.loadingRate?s("section",{staticClass:"symbol"},[s("i",{staticClass:"icon-spin4 animate-spin"})]):s("section",{staticClass:"symbol"},[s("TokenSymbol",{attrs:{token:t.pair}})],1):s("section",{staticClass:"symbol icon-attention-circled"}),t._v(" "),t.pair?t._e():s("section",[t.pairs.length?s("figure",{staticClass:"name"},[t._v(t._s(t.$t("generic.selectToken")))]):s("figure",{staticClass:"name"},[t._v(t._s(t.$t("exchange.noPairs")))])]),t._v(" "),t.pair?s("section",[t.loadingRate?t._e():s("figure",{staticClass:"name value"},[t._v(t._s(t.estimatedAmount))]),t._v(" "),t.loadingRate?s("figure",{staticClass:"name"},[t._v(t._s(t.$t("exchange.loadingRate")))]):t._e(),t._v(" "),t.pair?s("figure",{staticClass:"network"},[t._v(t._s(t.pair.symbol))]):t._e()]):t._e(),t._v(" "),t.pairs.length?s("figure",{staticClass:"chevron fas fa-caret-square-down"}):t._e()])])])])]),t._v(" "),s("section",{staticClass:"tail"},[s("Button",{attrs:{disabled:!t.canExchange,big:"1",text:"Exchange",blue:"1"},nativeOn:{click:function(e){return t.exchange(e)}}})],1)]):t._e()])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("section",{staticClass:"symbol"},[e("i",{staticClass:"icon-spin4 animate-spin"})])}],!1,null,"1473bdcc",null);e.default=x.exports},Vbfb:function(t,e,s){var i=s("XTGD");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,s("SZ7m").default)("6d268752",i,!0,{})},XTGD:function(t,e,s){(t.exports=s("JPst")(!1)).push([t.i,"",""])}}]);